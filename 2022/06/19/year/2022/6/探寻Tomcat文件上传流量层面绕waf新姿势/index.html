<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="description" content="æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿å†™åœ¨å‰é¢â€‹    æ— æ„ä¸­çœ‹åˆ°ch1ngå¸ˆå‚…çš„æ–‡ç« è§‰å¾—å¾ˆæœ‰è¶£ï¼Œä¸å¾—ä¸æ„Ÿå¹å¸ˆå‚…å¤ªå‰å®³äº†ï¼Œä½†æˆ‘ä¸€çœ‹é‚£é•¿ç¯‡çš„å‡½æ•°æ€»è§‰å¾—ä¼šæœ‰æ›´éªšçš„ä¸œè¥¿ï¼Œæ‰€å¹¸è¿˜çœŸçš„æœ‰ï¼Œå€Ÿæ­¤æœºä¼šå°±å‘å‡ºæ¥ä¸€æ¢ç©¶ç«Ÿï¼ŒåŒæ—¶ä¹Ÿä¸å¾—ä¸æ„Ÿæ…¨ä¸‹RFCæ–‡æ¡£çš„å¦™å¤„ï¼Œå½“ç„¶æœ¬æ–‡é’ˆå¯¹çš„æŠ€æœ¯ä¹Ÿä»…ä»…åªæ˜¯åœ¨æµé‡å±‚é¢ä¸Šwafçš„ç»•è¿‡ Preå¾ˆç¥å¥‡å¯¹å§ï¼Œå½“ç„¶è¿™ä¸æ˜¯ç»ˆç‚¹,æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä¸€æ¢ç©¶ç«Ÿ  å‰ç½®è¿™é‡Œç®€å•è¯´ä¸€ä¸‹å¸ˆå‚…çš„æ€è·¯ éƒ¨ç½²ä¸å¤„"><meta property="og:type" content="article"><meta property="og:title" content="æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><meta property="og:url" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/index.html"><meta property="og:site_name" content="Y4tacker:Hacking The World!"><meta property="og:description" content="æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿å†™åœ¨å‰é¢â€‹    æ— æ„ä¸­çœ‹åˆ°ch1ngå¸ˆå‚…çš„æ–‡ç« è§‰å¾—å¾ˆæœ‰è¶£ï¼Œä¸å¾—ä¸æ„Ÿå¹å¸ˆå‚…å¤ªå‰å®³äº†ï¼Œä½†æˆ‘ä¸€çœ‹é‚£é•¿ç¯‡çš„å‡½æ•°æ€»è§‰å¾—ä¼šæœ‰æ›´éªšçš„ä¸œè¥¿ï¼Œæ‰€å¹¸è¿˜çœŸçš„æœ‰ï¼Œå€Ÿæ­¤æœºä¼šå°±å‘å‡ºæ¥ä¸€æ¢ç©¶ç«Ÿï¼ŒåŒæ—¶ä¹Ÿä¸å¾—ä¸æ„Ÿæ…¨ä¸‹RFCæ–‡æ¡£çš„å¦™å¤„ï¼Œå½“ç„¶æœ¬æ–‡é’ˆå¯¹çš„æŠ€æœ¯ä¹Ÿä»…ä»…åªæ˜¯åœ¨æµé‡å±‚é¢ä¸Šwafçš„ç»•è¿‡ Preå¾ˆç¥å¥‡å¯¹å§ï¼Œå½“ç„¶è¿™ä¸æ˜¯ç»ˆç‚¹,æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä¸€æ¢ç©¶ç«Ÿ  å‰ç½®è¿™é‡Œç®€å•è¯´ä¸€ä¸‹å¸ˆå‚…çš„æ€è·¯ éƒ¨ç½²ä¸å¤„"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/res.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/1.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/2.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/3.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/4.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/5.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/6.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/7.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/8.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/9.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/21.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/22.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/10.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/14.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/15.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/16.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/17.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/18.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/19.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/11.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/12.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/13.png"><meta property="og:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/20.png"><meta property="article:published_time" content="2022-06-19T05:50:24.000Z"><meta property="article:modified_time" content="2024-08-04T09:01:49.648Z"><meta property="article:author" content="Y4tacker"><meta property="article:tag" content="Java"><meta property="article:tag" content="Waf"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/res.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿</title><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="Y4tacker:Hacking The World!" type="application/atom+xml"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" aria-label="Top" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fa-solid fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" aria-label="Previous post" href="/2022/06/21/year/2022/6/%E6%8E%A2%E5%AF%BBJava%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2waf%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF%E7%B3%BB%E5%88%97%E4%BA%8C/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" aria-label="Next post" href="/2022/06/19/year/2022/6/%E5%85%B3%E4%BA%8Epearcmd%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" aria-label="Back to top" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&text=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&is_video=false&description=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿&body=Check out this article: https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&name=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&t=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF"><span class="toc-number">1.</span> <span class="toc-text">æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.1.</span> <span class="toc-text">å†™åœ¨å‰é¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pre"><span class="toc-number">1.2.</span> <span class="toc-text">Pre</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">å‰ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5"><span class="toc-number">1.4.</span> <span class="toc-text">æ·±å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E5%BD%A2-%E6%9B%B4%E6%96%B02022-06-20"><span class="toc-number">1.5.</span> <span class="toc-text">å˜å½¢ æ›´æ–°2022-06-20</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%A4%A7%E5%88%A9%E7%94%A8%E9%9D%A2"><span class="toc-number">1.6.</span> <span class="toc-text">æ‰©å¤§åˆ©ç”¨é¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0Spring-2022-06-20"><span class="toc-number">1.7.</span> <span class="toc-text">æ›´æ–°Spring 2022-06-20</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring4"><span class="toc-number">1.7.1.</span> <span class="toc-text">Spring4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring5"><span class="toc-number">1.7.2.</span> <span class="toc-text">Spring5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">1.8.</span> <span class="toc-text">å‚è€ƒæ–‡ç« </span></a></li></ol></li></ol></div></span></div><div class="content index py4"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle p-name" itemprop="name headline">æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿</h1><div class="meta"><span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-name" itemprop="name">Y4tacker</span></span><div class="postdate"><time datetime="2022-06-19T05:50:24.000Z" class="dt-published" itemprop="datePublished">2022-06-19</time> (Updated: <time datetime="2024-08-04T09:01:49.648Z" class="dt-updated" itemprop="dateModified">2024-08-04</time>)</div><div class="article-category"><i class="fa-solid fa-archive"></i> <a class="category-link" href="/categories/Java/">Java</a></div><div class="article-tag"><i class="fa-solid fa-tag"></i> <a class="p-category" href="/tags/Java/" rel="tag">Java</a>, <a class="p-category" href="/tags/Waf/" rel="tag">Waf</a></div></div></header><div class="content e-content" itemprop="articleBody"><h1 id="æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><a href="#æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿" class="headerlink" title="æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"></a>æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿</h1><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>â€‹ æ— æ„ä¸­çœ‹åˆ°ch1ngå¸ˆå‚…çš„æ–‡ç« è§‰å¾—å¾ˆæœ‰è¶£ï¼Œä¸å¾—ä¸æ„Ÿå¹å¸ˆå‚…å¤ªå‰å®³äº†ï¼Œä½†æˆ‘ä¸€çœ‹é‚£é•¿ç¯‡çš„å‡½æ•°æ€»è§‰å¾—ä¼šæœ‰æ›´éªšçš„ä¸œè¥¿ï¼Œæ‰€å¹¸è¿˜çœŸçš„æœ‰ï¼Œå€Ÿæ­¤æœºä¼šå°±å‘å‡ºæ¥ä¸€æ¢ç©¶ç«Ÿï¼ŒåŒæ—¶ä¹Ÿä¸å¾—ä¸æ„Ÿæ…¨ä¸‹RFCæ–‡æ¡£çš„å¦™å¤„ï¼Œå½“ç„¶æœ¬æ–‡é’ˆå¯¹çš„æŠ€æœ¯ä¹Ÿä»…ä»…åªæ˜¯åœ¨æµé‡å±‚é¢ä¸Šwafçš„ç»•è¿‡</p><h2 id="Pre"><a href="#Pre" class="headerlink" title="Pre"></a>Pre</h2><p>å¾ˆç¥å¥‡å¯¹å§ï¼Œå½“ç„¶è¿™ä¸æ˜¯ç»ˆç‚¹,æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä¸€æ¢ç©¶ç«Ÿ</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/res.png"></p><h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><p>è¿™é‡Œç®€å•è¯´ä¸€ä¸‹å¸ˆå‚…çš„æ€è·¯</p><p>éƒ¨ç½²ä¸å¤„ç†ä¸Šä¼ warçš„servletæ˜¯<code>org.apache.catalina.manager.HTMLManagerServlet</code></p><p>åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶æœ€ç»ˆä¼šé€šè¿‡å¤„ç†<code>org.apache.catalina.manager.HTMLManagerServlet#upload</code></p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/1.png"></p><p>è°ƒç”¨çš„æ˜¯å…¶å­ç±»å®ç°ç±»<code>org.apache.catalina.core.ApplicationPart#getSubmittedFileName</code></p><p>è¿™é‡Œè·å–filenameçš„æ—¶å€™çš„å¤„ç†å¾ˆæœ‰è¶£</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/2.png"></p><p>çœ‹åˆ°è¿™æ®µæ³¨é‡Šï¼Œå‘ç°åœ¨RFC 6266æ–‡æ¡£å½“ä¸­ä¹Ÿæå‡ºè¿™ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Avoid including the &quot;\&quot; character in the quoted-string form of the filename parameter, as escaping is not implemented by some user agents, and &quot;\&quot; can be considered an illegal path character.</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬çš„tomcatæ˜¯å¦‚ä½•å¤„ç†çš„å˜ï¼Ÿè¿™é‡Œå®ƒé€šè¿‡å‡½æ•°<code>HttpParser.unquote</code>å»è¿›è¡Œå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">unquote</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="keyword">null</span> || input.length() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> input;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> start;</span><br><span class="line">        <span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Skip surrounding quotes if there are any</span></span><br><span class="line">        <span class="keyword">if</span> (input.charAt(<span class="number">0</span>) == <span class="string">&#x27;&quot;&#x27;</span>) &#123;</span><br><span class="line">            start = <span class="number">1</span>;</span><br><span class="line">            end = input.length() - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            start = <span class="number">0</span>;</span><br><span class="line">            end = input.length();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder result = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = start ; i &lt; end; i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = input.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (input.charAt(i) == <span class="string">&#x27;\\&#x27;</span>) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                result.append(input.charAt(i));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result.append(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç®€å•åšä¸ªæ€»ç»“å¦‚æœé¦–ä½æ˜¯<code>&quot;</code>(å‰ææ¡ä»¶æ˜¯é‡Œé¢æœ‰<code>\</code>å­—ç¬¦)ï¼Œé‚£ä¹ˆå°±ä¼šå»æ‰è·³è¿‡ä»ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹ï¼Œå¹¶ä¸”æœ«å°¾ä¹Ÿä¼šå¾€å‰ç§»åŠ¨ä¸€ä½ï¼ŒåŒæ—¶ä¼šå¿½ç•¥å­—ç¬¦<code>\</code>ï¼Œå¸ˆå‚…åªæåˆ°äº†ç±»ä¼¼<code>test.\war</code>è¿™æ ·çš„ä¾‹å­</p><p>ä½†å…¶å®æ ¹æ®è¿™ä¸ªæˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥æ„é€ ä¸€äº›çœ‹ç€æ¯”è¾ƒæ¶å¿ƒçš„æ¯”å¦‚<code>filename=&quot;&quot;y\4.\w\arK&quot;</code></p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/3.png"></p><h2 id="æ·±å…¥"><a href="#æ·±å…¥" class="headerlink" title="æ·±å…¥"></a>æ·±å…¥</h2><p>è¿˜æ˜¯åœ¨<code>org.apache.catalina.core.ApplicationPart#getSubmittedFileName</code>å½“ä¸­ï¼Œä¸€çœ‹åˆ°è¿™ä¸ªå°†å­—ç¬¦ä¸²è½¬æ¢æˆmapçš„æ“ä½œæ€»è§‰å¾—é‡Œé¢ä¼šæœ‰æ›´éªšçš„ä¸œè¥¿(è¿™é‡Œå…ˆæ˜¯è§£æä¼ å…¥çš„å‚æ•°å†è·å–ï¼Œå¦‚æœè§£æè¿‡ç¨‹æœ‰åˆ©ç”¨ç‚¹é‚£ä¹ˆä¹Ÿä¼šå½±å“åˆ°åé¢å‚æ•°è·å–)ï¼Œä¸æ‰¯è¿œç»§ç»­å›åˆ°æ­£é¢˜</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/4.png"></p><p>é¦–å…ˆå®ƒä¼šè·å–headerå‚æ•°<code>Content-Disposition</code>å½“ä¸­çš„å€¼ï¼Œå¦‚æœä»¥<code>form-data</code>æˆ–è€…<code>attachment</code>å¼€å¤´å°±ä¼šè¿›è¡Œæˆ‘ä»¬çš„è§£ææ“ä½œï¼Œè·Ÿè¿›å»ä¸€çœ‹æœä¸å…¶ç„¶ï¼Œçœ‹åˆ°<code>RFC2231Utility</code>ç¬é—´ä¸å›°äº†</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/5.png"></p><p>åé¢è¿™ä¸€å¨å°±ä¸å¿…å¤šè¯´äº†ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»å¾ˆç†Ÿæ‚‰å•¦æ”¯æŒQPç¼–ç ï¼Œå¿˜äº†çš„å¯ä»¥è€ƒå¤çœ‹çœ‹æˆ‘ä¹‹å‰å†™çš„æ–‡ç« <a href="https://y4tacker.github.io/2022/02/25/year/2022/2/Java%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%9D%80%E5%99%A8-%E7%BB%95waf(%E9%92%88%E5%AF%B9commons-fileupload%E7%BB%84%E4%BB%B6)/">Javaæ–‡ä»¶ä¸Šä¼ å¤§æ€å™¨-ç»•waf(é’ˆå¯¹commons-fileuploadç»„ä»¶)</a>ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤è¿™ä¸ªå•¦ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸‰å…ƒè¿ç®—ç¬¦å‰é¢çš„è¿™æ®µ</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªhasEncodedValueåˆ¤æ–­æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Œå­—ç¬¦ä¸²æœ«å°¾æ˜¯å¦å¸¦<code>*</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasEncodedValue</span><span class="params">(<span class="keyword">final</span> String paramName)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (paramName != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> paramName.lastIndexOf(<span class="string">&#x27;*&#x27;</span>) == (paramName.length() - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨çœ‹è§£å¯†å‡½æ•°ä¹‹å‰æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹<a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc2231#section-4">RFC 2231</a>æ–‡æ¡£å½“ä¸­å¯¹æ­¤çš„æè¿°ï¼Œè‹±æ–‡å€’æ˜¯å¾ˆç®€å•ä¸æ‡‚çš„å¯ä»¥åœ¨çº¿ç¿»ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸è´´ä¸­æ–‡äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Asterisks (&quot;*&quot;) are reused to provide the indicator that language and character set information is present and encoding is being used. A single quote (&quot;&#x27;&quot;) is used to delimit the character set and language information at the beginning of the parameter value. Percent signs (&quot;%&quot;) are used as the encoding flag, which agrees with RFC 2047.</span><br><span class="line">Specifically, an asterisk at the end of a parameter name acts as an indicator that character set and language information may appear at  the beginning of the parameter value. A single quote is used to separate the character set, language, and actual value information in the parameter value string, and an percent sign is used to flag octets encoded in hexadecimal.  For example:</span><br><span class="line">Content-Type: application/x-stuff;</span><br><span class="line">         title*=us-ascii&#x27;en-us&#x27;This%20is%20%2A%2A%2Afun%2A%2A%2A</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å›åˆ°æ­£é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹çœ‹è¿™ä¸ªè§£ç åšäº†äº›ä»€ä¹ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decodeText</span><span class="params">(<span class="keyword">final</span> String encodedText)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> langDelimitStart = encodedText.indexOf(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (langDelimitStart == -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// missing charset</span></span><br><span class="line">    <span class="keyword">return</span> encodedText;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> String mimeCharset = encodedText.substring(<span class="number">0</span>, langDelimitStart);</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> langDelimitEnd = encodedText.indexOf(<span class="string">&#x27;\&#x27;&#x27;</span>, langDelimitStart + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (langDelimitEnd == -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// missing language</span></span><br><span class="line">    <span class="keyword">return</span> encodedText;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">byte</span>[] bytes = fromHex(encodedText.substring(langDelimitEnd + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> String(bytes, getJavaCharset(mimeCharset));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“åˆæ³¨é‡Šå¯ä»¥çœ‹åˆ°æ ‡å‡†æ ¼å¼<code>@param encodedText - Text to be decoded has a format of &#123;@code &lt;charset&gt;&#39;&lt;language&gt;&#39;&lt;encoded_value&gt;&#125;</code>,åˆ†åˆ«æ˜¯ç¼–ç ï¼Œè¯­è¨€å’Œå¾…è§£ç çš„å­—ç¬¦ä¸²ï¼ŒåŒæ—¶è¿™é‡Œè¿˜é€‚é…äº†å¯¹urlç¼–ç çš„è§£ç ï¼Œä¹Ÿå°±æ˜¯<code>fromHex</code>å‡½æ•°,å…·ä½“ä»£ç å¦‚ä¸‹ï¼Œå…¶å®å°±æ˜¯urlè§£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] fromHex(<span class="keyword">final</span> String text) &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> shift = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">final</span> ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream(text.length());</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; text.length();) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">char</span> c = text.charAt(i++);</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &gt; text.length() - <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>; <span class="comment">// unterminated sequence</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">byte</span> b1 = HEX_DECODE[text.charAt(i++) &amp; MASK];</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">byte</span> b2 = HEX_DECODE[text.charAt(i++) &amp; MASK];</span><br><span class="line">      out.write((b1 &lt;&lt; shift) | b2);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      out.write((<span class="keyword">byte</span>) c);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> out.toByteArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å°†å€¼å½“ä¸­å€¼å¾—æ³¨æ„çš„ç‚¹æ¢³ç†ä¸€ä¸‹</p><ol><li>æ”¯æŒç¼–ç çš„è§£ç </li><li>å€¼å½“ä¸­å¯ä»¥è¿›è¡Œurlç¼–ç </li><li>@code&lt;charset&gt;&#39;&lt;language&gt;&#39;&lt;encoded_value&gt; ä¸­é—´è¿™ä½languageå¯ä»¥éšä¾¿å†™ï¼Œä»£ç é‡Œæ²¡æœ‰ç”¨åˆ°è¿™ä¸ªçš„å¤„ç†</li></ol><p>æ—¢ç„¶å¦‚æ­¤é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå°±å¯ä»¥æ’å‡ºæ‰utf-8ï¼Œæ¯•ç«Ÿè¿™ä¸ªè§£ç åå°±ç›´æ¥æ˜¯æ˜æ–‡ï¼Œä»Javaæ ‡å‡†åº“å½“ä¸­çš„charsets.jarå¯ä»¥çœ‹å‡ºï¼Œæ”¯æŒçš„ç¼–ç æœ‰å¾ˆå¤š</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/6.png"></p><p>åŒæ—¶é€šè¿‡ç®€å•çš„ä»£ç ä¹Ÿå¯ä»¥è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Locale locale = Locale.getDefault();</span><br><span class="line">Map&lt;String, Charset&gt; maps = Charset.availableCharsets();</span><br><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">sb.append(<span class="string">&quot;&#123;&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, Charset&gt; entry : maps.entrySet()) &#123;</span><br><span class="line">  String key = entry.getKey();</span><br><span class="line">  Charset value = entry.getValue();</span><br><span class="line">  sb.append(<span class="string">&quot;\&quot;&quot;</span> + key + <span class="string">&quot;\&quot;,&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">sb.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">System.out.println(sb.toString());</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//res</span></span><br><span class="line">&#123;<span class="string">&quot;Big5&quot;</span>,<span class="string">&quot;Big5-HKSCS&quot;</span>,<span class="string">&quot;CESU-8&quot;</span>,<span class="string">&quot;EUC-JP&quot;</span>,<span class="string">&quot;EUC-KR&quot;</span>,<span class="string">&quot;GB18030&quot;</span>,<span class="string">&quot;GB2312&quot;</span>,<span class="string">&quot;GBK&quot;</span>,<span class="string">&quot;IBM-Thai&quot;</span>,<span class="string">&quot;IBM00858&quot;</span>,<span class="string">&quot;IBM01140&quot;</span>,<span class="string">&quot;IBM01141&quot;</span>,<span class="string">&quot;IBM01142&quot;</span>,<span class="string">&quot;IBM01143&quot;</span>,<span class="string">&quot;IBM01144&quot;</span>,<span class="string">&quot;IBM01145&quot;</span>,<span class="string">&quot;IBM01146&quot;</span>,<span class="string">&quot;IBM01147&quot;</span>,<span class="string">&quot;IBM01148&quot;</span>,<span class="string">&quot;IBM01149&quot;</span>,<span class="string">&quot;IBM037&quot;</span>,<span class="string">&quot;IBM1026&quot;</span>,<span class="string">&quot;IBM1047&quot;</span>,<span class="string">&quot;IBM273&quot;</span>,<span class="string">&quot;IBM277&quot;</span>,<span class="string">&quot;IBM278&quot;</span>,<span class="string">&quot;IBM280&quot;</span>,<span class="string">&quot;IBM284&quot;</span>,<span class="string">&quot;IBM285&quot;</span>,<span class="string">&quot;IBM290&quot;</span>,<span class="string">&quot;IBM297&quot;</span>,<span class="string">&quot;IBM420&quot;</span>,<span class="string">&quot;IBM424&quot;</span>,<span class="string">&quot;IBM437&quot;</span>,<span class="string">&quot;IBM500&quot;</span>,<span class="string">&quot;IBM775&quot;</span>,<span class="string">&quot;IBM850&quot;</span>,<span class="string">&quot;IBM852&quot;</span>,<span class="string">&quot;IBM855&quot;</span>,<span class="string">&quot;IBM857&quot;</span>,<span class="string">&quot;IBM860&quot;</span>,<span class="string">&quot;IBM861&quot;</span>,<span class="string">&quot;IBM862&quot;</span>,<span class="string">&quot;IBM863&quot;</span>,<span class="string">&quot;IBM864&quot;</span>,<span class="string">&quot;IBM865&quot;</span>,<span class="string">&quot;IBM866&quot;</span>,<span class="string">&quot;IBM868&quot;</span>,<span class="string">&quot;IBM869&quot;</span>,<span class="string">&quot;IBM870&quot;</span>,<span class="string">&quot;IBM871&quot;</span>,<span class="string">&quot;IBM918&quot;</span>,<span class="string">&quot;ISO-2022-CN&quot;</span>,<span class="string">&quot;ISO-2022-JP&quot;</span>,<span class="string">&quot;ISO-2022-JP-2&quot;</span>,<span class="string">&quot;ISO-2022-KR&quot;</span>,<span class="string">&quot;ISO-8859-1&quot;</span>,<span class="string">&quot;ISO-8859-13&quot;</span>,<span class="string">&quot;ISO-8859-15&quot;</span>,<span class="string">&quot;ISO-8859-2&quot;</span>,<span class="string">&quot;ISO-8859-3&quot;</span>,<span class="string">&quot;ISO-8859-4&quot;</span>,<span class="string">&quot;ISO-8859-5&quot;</span>,<span class="string">&quot;ISO-8859-6&quot;</span>,<span class="string">&quot;ISO-8859-7&quot;</span>,<span class="string">&quot;ISO-8859-8&quot;</span>,<span class="string">&quot;ISO-8859-9&quot;</span>,<span class="string">&quot;JIS_X0201&quot;</span>,<span class="string">&quot;JIS_X0212-1990&quot;</span>,<span class="string">&quot;KOI8-R&quot;</span>,<span class="string">&quot;KOI8-U&quot;</span>,<span class="string">&quot;Shift_JIS&quot;</span>,<span class="string">&quot;TIS-620&quot;</span>,<span class="string">&quot;US-ASCII&quot;</span>,<span class="string">&quot;UTF-16&quot;</span>,<span class="string">&quot;UTF-16BE&quot;</span>,<span class="string">&quot;UTF-16LE&quot;</span>,<span class="string">&quot;UTF-32&quot;</span>,<span class="string">&quot;UTF-32BE&quot;</span>,<span class="string">&quot;UTF-32LE&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>,<span class="string">&quot;windows-1250&quot;</span>,<span class="string">&quot;windows-1251&quot;</span>,<span class="string">&quot;windows-1252&quot;</span>,<span class="string">&quot;windows-1253&quot;</span>,<span class="string">&quot;windows-1254&quot;</span>,<span class="string">&quot;windows-1255&quot;</span>,<span class="string">&quot;windows-1256&quot;</span>,<span class="string">&quot;windows-1257&quot;</span>,<span class="string">&quot;windows-1258&quot;</span>,<span class="string">&quot;windows-31j&quot;</span>,<span class="string">&quot;x-Big5-HKSCS-2001&quot;</span>,<span class="string">&quot;x-Big5-Solaris&quot;</span>,<span class="string">&quot;x-COMPOUND_TEXT&quot;</span>,<span class="string">&quot;x-euc-jp-linux&quot;</span>,<span class="string">&quot;x-EUC-TW&quot;</span>,<span class="string">&quot;x-eucJP-Open&quot;</span>,<span class="string">&quot;x-IBM1006&quot;</span>,<span class="string">&quot;x-IBM1025&quot;</span>,<span class="string">&quot;x-IBM1046&quot;</span>,<span class="string">&quot;x-IBM1097&quot;</span>,<span class="string">&quot;x-IBM1098&quot;</span>,<span class="string">&quot;x-IBM1112&quot;</span>,<span class="string">&quot;x-IBM1122&quot;</span>,<span class="string">&quot;x-IBM1123&quot;</span>,<span class="string">&quot;x-IBM1124&quot;</span>,<span class="string">&quot;x-IBM1166&quot;</span>,<span class="string">&quot;x-IBM1364&quot;</span>,<span class="string">&quot;x-IBM1381&quot;</span>,<span class="string">&quot;x-IBM1383&quot;</span>,<span class="string">&quot;x-IBM300&quot;</span>,<span class="string">&quot;x-IBM33722&quot;</span>,<span class="string">&quot;x-IBM737&quot;</span>,<span class="string">&quot;x-IBM833&quot;</span>,<span class="string">&quot;x-IBM834&quot;</span>,<span class="string">&quot;x-IBM856&quot;</span>,<span class="string">&quot;x-IBM874&quot;</span>,<span class="string">&quot;x-IBM875&quot;</span>,<span class="string">&quot;x-IBM921&quot;</span>,<span class="string">&quot;x-IBM922&quot;</span>,<span class="string">&quot;x-IBM930&quot;</span>,<span class="string">&quot;x-IBM933&quot;</span>,<span class="string">&quot;x-IBM935&quot;</span>,<span class="string">&quot;x-IBM937&quot;</span>,<span class="string">&quot;x-IBM939&quot;</span>,<span class="string">&quot;x-IBM942&quot;</span>,<span class="string">&quot;x-IBM942C&quot;</span>,<span class="string">&quot;x-IBM943&quot;</span>,<span class="string">&quot;x-IBM943C&quot;</span>,<span class="string">&quot;x-IBM948&quot;</span>,<span class="string">&quot;x-IBM949&quot;</span>,<span class="string">&quot;x-IBM949C&quot;</span>,<span class="string">&quot;x-IBM950&quot;</span>,<span class="string">&quot;x-IBM964&quot;</span>,<span class="string">&quot;x-IBM970&quot;</span>,<span class="string">&quot;x-ISCII91&quot;</span>,<span class="string">&quot;x-ISO-2022-CN-CNS&quot;</span>,<span class="string">&quot;x-ISO-2022-CN-GB&quot;</span>,<span class="string">&quot;x-iso-8859-11&quot;</span>,<span class="string">&quot;x-JIS0208&quot;</span>,<span class="string">&quot;x-JISAutoDetect&quot;</span>,<span class="string">&quot;x-Johab&quot;</span>,<span class="string">&quot;x-MacArabic&quot;</span>,<span class="string">&quot;x-MacCentralEurope&quot;</span>,<span class="string">&quot;x-MacCroatian&quot;</span>,<span class="string">&quot;x-MacCyrillic&quot;</span>,<span class="string">&quot;x-MacDingbat&quot;</span>,<span class="string">&quot;x-MacGreek&quot;</span>,<span class="string">&quot;x-MacHebrew&quot;</span>,<span class="string">&quot;x-MacIceland&quot;</span>,<span class="string">&quot;x-MacRoman&quot;</span>,<span class="string">&quot;x-MacRomania&quot;</span>,<span class="string">&quot;x-MacSymbol&quot;</span>,<span class="string">&quot;x-MacThai&quot;</span>,<span class="string">&quot;x-MacTurkish&quot;</span>,<span class="string">&quot;x-MacUkraine&quot;</span>,<span class="string">&quot;x-MS932_0213&quot;</span>,<span class="string">&quot;x-MS950-HKSCS&quot;</span>,<span class="string">&quot;x-MS950-HKSCS-XP&quot;</span>,<span class="string">&quot;x-mswin-936&quot;</span>,<span class="string">&quot;x-PCK&quot;</span>,<span class="string">&quot;x-SJIS_0213&quot;</span>,<span class="string">&quot;x-UTF-16LE-BOM&quot;</span>,<span class="string">&quot;X-UTF-32BE-BOM&quot;</span>,<span class="string">&quot;X-UTF-32LE-BOM&quot;</span>,<span class="string">&quot;x-windows-50220&quot;</span>,<span class="string">&quot;x-windows-50221&quot;</span>,<span class="string">&quot;x-windows-874&quot;</span>,<span class="string">&quot;x-windows-949&quot;</span>,<span class="string">&quot;x-windows-950&quot;</span>,<span class="string">&quot;x-windows-iso2022jp&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½œä¸ºæ¼”ç¤ºæˆ‘å°±éšä¾¿é€‰ä¸€ä¸ªäº†<code>UTF-16BE</code></p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/7.png"></p><p>åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œå¥—å¨ƒç»“åˆä¸Šé¢çš„<code>filename=&quot;&quot;y\4.\w\arK&quot;</code>æ”¹æˆ<code>filename=&quot;UTF-16BE&#39;Y4tacker&#39;%00%22%00y%00%5C%004%00.%00%5C%00w%00%5C%00a%00r%00K&quot;</code></p><p>æ¥ä¸‹æ¥å¤„ç†ç‚¹å°åŠ å¼ºï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œåˆ†éš”ç¬¦æ— é™åŠ ï¼Œè€Œä¸”åŠ äº†ğŸŒŸå·çš„å­—ç¬¦ä¹‹åä¹Ÿä¼šå»é™¤ä¸€ä¸ªğŸŒŸå·</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/8.png"></p><p>å› æ­¤æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å¾—åˆ°å¦‚ä¸‹payloadï¼Œæ­¤æ—¶ä»…ä»…åŸºäºæ­£åˆ™çš„wafè§„åˆ™å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤±æ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryQKTY1MomsixvN8vX</span><br><span class="line">Content-Disposition: form-data*;;;;;;;;;;name*=<span class="string">&quot;UTF-16BE&#x27;Y4tacker&#x27;%00d%00e%00p%00l%00o%00y%00W%00a%00r&quot;</span>;;;;;;;;filename*=<span class="string">&quot;UTF-16BE&#x27;Y4tacker&#x27;%00%22%00y%00%5C%004%00.%00%5C%00w%00%5C%00a%00r%00K&quot;</span></span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line"><span class="number">123</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryQKTY1MomsixvN8vX--</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§æˆåŠŸä¸Šä¼ </p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/9.png"></p><h2 id="å˜å½¢-æ›´æ–°2022-06-20"><a href="#å˜å½¢-æ›´æ–°2022-06-20" class="headerlink" title="å˜å½¢ æ›´æ–°2022-06-20"></a>å˜å½¢ æ›´æ–°2022-06-20</h2><p>è¿™é‡Œæµ‹è¯•ç‰ˆæœ¬æ˜¯Tomcat8.5.72ï¼Œè¿™é‡Œä¹Ÿä¸æƒ³å†æµ‹å…¶ä»–ç‰ˆæœ¬å·®å¼‚äº†åªæ˜¯æä¾›ä¸€ç§æ€è·¯</p><p>åœ¨æ­¤åŸºç¡€ä¸Šæˆ‘å‘ç°è¿˜å¯ä»¥åšä¸€äº›æ–°çš„ä¸œè¥¿ï¼Œå…¶å®å°±æ˜¯å¯¹<code>org.apache.tomcat.util.http.fileupload.ParameterParser#parse(char[], int, int, char)</code>å‡½æ•°è¿›è¡Œæ·±å…¥åˆ†æ</p><p>åœ¨è·å–å€¼çš„æ—¶å€™<code>paramValue = parseQuotedToken(new char[] &#123;separator &#125;);</code>ï¼Œå…¶å®æ˜¯æŒ‰ç…§åˆ†éš”ç¬¦<code>;</code>åˆ†å‰²ï¼Œå› æ­¤æˆ‘ä»¬ä¸éš¾æƒ³åˆ°å‰é¢çš„ä¸œè¥¿å…¶å®å¯ä»¥ä¸ç”¨<code>&quot;</code>è¿›è¡ŒåŒ…è£¹ï¼Œåœ¨parseQuotedTokenæœ€åè¿”å›è°ƒç”¨çš„æ˜¯<code>return getToken(true);</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿå¾ˆç®€å•å°±ä¸å¿…å¤šè§£é‡Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getToken</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> quoted)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Trim leading white spaces</span></span><br><span class="line">        <span class="keyword">while</span> ((i1 &lt; i2) &amp;&amp; (Character.isWhitespace(chars[i1]))) &#123;</span><br><span class="line">            i1++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Trim trailing white spaces</span></span><br><span class="line">        <span class="keyword">while</span> ((i2 &gt; i1) &amp;&amp; (Character.isWhitespace(chars[i2 - <span class="number">1</span>]))) &#123;</span><br><span class="line">            i2--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Strip away quotation marks if necessary</span></span><br><span class="line">        <span class="keyword">if</span> (quoted</span><br><span class="line">            &amp;&amp; ((i2 - i1) &gt;= <span class="number">2</span>)</span><br><span class="line">            &amp;&amp; (chars[i1] == <span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">            &amp;&amp; (chars[i2 - <span class="number">1</span>] == <span class="string">&#x27;&quot;&#x27;</span>)) &#123;</span><br><span class="line">            i1++;</span><br><span class="line">            i2--;</span><br><span class="line">        &#125;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (i2 &gt; i1) &#123;</span><br><span class="line">            result = <span class="keyword">new</span> String(chars, i1, i2 - i1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¹Ÿæ˜¯æˆåŠŸè¯†åˆ«çš„</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/21.png"></p><p>æ—¢ç„¶è°ƒç”¨<code>parse</code>è§£æå‚æ•°æ—¶å¯ä»¥ä¸è¢«åŒ…è£¹ï¼Œç»“åˆgetTokenå‡½æ•°æˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨æœ€åä¸€ä¸ªå‚æ•°å…¶å®å°±ä¸å¿…è¦åŠ <code>;</code>äº†ï¼Œå¹¶ä¸”è§£æå®Œé€šè¿‡<code>params.get(&quot;filename&quot;)</code>è·å–åˆ°å‚æ•°åè¿˜ä¼šè°ƒç”¨åˆ°<code>org.apache.tomcat.util.http.parser.HttpParser#unquote</code>é‚£ä¹Ÿå¯ä»¥åŸºäºæ­¤å†æ¬¡å˜å½¢</p><p>ä¸ºäº†ç›´è§‚è¿™é‡Œå°±ç›´æ¥æ˜æ–‡äº†ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¾ˆç¥å¥‡</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/22.png"></p><h2 id="æ‰©å¤§åˆ©ç”¨é¢"><a href="#æ‰©å¤§åˆ©ç”¨é¢" class="headerlink" title="æ‰©å¤§åˆ©ç”¨é¢"></a>æ‰©å¤§åˆ©ç”¨é¢</h2><p>ç°åœ¨åªæ˜¯waråŒ…çš„åœºæ™¯ï¼Œå¤šå¤šå°‘å°‘å½±å“æ€§è¢«é™ä½ï¼Œä½†æˆ‘ä»¬è¿™ä¸²ä»£ç å…¶å®æŠ½è±¡å‡ºæ¥å°±ä¸€ä¸ªå…³é”®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Part warPart = request.getPart(<span class="string">&quot;deployWar&quot;</span>);</span><br><span class="line">String filename = warPart.getSubmittedFileName();</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥è¯¢<a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/Part.html#getSubmittedFileName--">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå¯ä»¥å‘ç°ä»Servlet3.1å¼€å§‹ï¼Œtomcatæ–°å¢äº†å¯¹æ­¤çš„æ”¯æŒï¼Œä¹Ÿå°±æ„å‘³ç€ç®€å•é€šè¿‡<code>javax.servlet.http.HttpServletRequest#getParts</code>å³å¯ï¼Œç®€åŒ–äº†æˆ‘ä»¬æ–‡ä»¶ä¸Šä¼ çš„ä»£ç è´Ÿæ‹…(å¦‚æœæˆ‘æ˜¯å¼€å‘äººå‘˜ï¼Œæˆ‘è‚¯å®šé¦–é€‰ä¹Ÿä¼šä½¿ç”¨ï¼Œè°ä¸æƒ³å½“æ‡’ç‹—å‘¢)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">getSubmittedFileName</span></span><br><span class="line"><span class="function">String <span class="title">getSubmittedFileName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">Gets the file name specified by the client</span></span><br><span class="line"><span class="function">Returns:</span></span><br><span class="line"><span class="function">the submitted file name</span></span><br><span class="line"><span class="function">Since:</span></span><br><span class="line"><span class="function">Servlet 3.1</span></span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°Spring-2022-06-20"><a href="#æ›´æ–°Spring-2022-06-20" class="headerlink" title="æ›´æ–°Spring 2022-06-20"></a>æ›´æ–°Spring 2022-06-20</h2><p>æ—©ä¸Šèµ·åºŠæƒ³ç€æ˜¨æ™šå’Œé™ˆå¸ˆçš„ç¢°æ’ï¼Œèµ·åºŠååˆçœ‹äº†ä¸‹é™ˆå¸ˆçš„æ˜Ÿçƒï¼Œçœ‹åˆ°è¿™ä¸ªä¸å¦¨å†è¯•è¯•Springæ˜¯å¦ä¹ŸæŒ‰ç…§äº†RFCçš„å®ç°å‘¢ï¼ˆæ¯•ç«ŸSpringå†…ç½®äº†Tomcatï¼Œå¯èƒ½ä¼šæœ‰ç±»ä¼¼çš„å‘¢ï¼‰</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/10.png"></p><p>Springä¸ºæˆ‘ä»¬æä¾›äº†å¤„ç†æ–‡ä»¶ä¸Šä¼ MultipartFileçš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultipartFile</span> <span class="keyword">extends</span> <span class="title">InputStreamSource</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>; <span class="comment">//è·å–å‚æ•°å</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">String <span class="title">getOriginalFilename</span><span class="params">()</span></span>;<span class="comment">//åŸå§‹çš„æ–‡ä»¶å</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;<span class="comment">//å†…å®¹ç±»å‹</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span></span>; <span class="comment">//å¤§å°</span></span><br><span class="line">    <span class="keyword">byte</span>[] getBytes() <span class="keyword">throws</span> IOException;<span class="comment">// è·å–å­—èŠ‚æ•°ç»„</span></span><br><span class="line">    <span class="function">InputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;<span class="comment">//ä»¥æµæ–¹å¼è¿›è¡Œè¯»å–</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Resource <span class="title">getResource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MultipartFileResource(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transferTo</span><span class="params">(File var1)</span> <span class="keyword">throws</span> IOException, IllegalStateException</span>;</span><br><span class="line">	<span class="comment">// å†™å…¥æŒ‡å®špath</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">transferTo</span><span class="params">(Path dest)</span> <span class="keyword">throws</span> IOException, IllegalStateException </span>&#123;</span><br><span class="line">        FileCopyUtils.copy(<span class="keyword">this</span>.getInputStream(), Files.newOutputStream(dest));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œspringå¤„ç†æ–‡ä»¶ä¸Šä¼ é€»è¾‘çš„å…·ä½“å…³é”®é€»è¾‘åœ¨<code>org.springframework.web.multipart.support.StandardMultipartHttpServletRequest#parseRequest</code>ï¼ŒæŠ„ä¸ªæ–‡ä»¶ä¸Šä¼ demoæ¥è¿›è¡Œæµ‹è¯•åˆ†æ</p><h3 id="Spring4"><a href="#Spring4" class="headerlink" title="Spring4"></a>Spring4</h3><p>è¿™é‡Œæˆ‘æµ‹è¯•äº†<code>springboot1.5.20.RELEASE</code>å†…ç½®<code>Spring4.3.23</code>ï¼Œå…·ä½“å°ç‰ˆæœ¬ä¹‹é—´æ˜¯å¦æœ‰å·®å¼‚è¿™é‡Œå°±ä¸å†æ¢ç©¶</p><p>å…¶ä¸­å…³äº<code>org.springframework.web.multipart.support.StandardMultipartHttpServletRequest#parseRequest</code>çš„è°ƒç”¨ä¹Ÿæœ‰äº›ä¸åŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Collection&lt;Part&gt; parts = request.getParts();</span><br><span class="line">        <span class="keyword">this</span>.multipartParameterNames = <span class="keyword">new</span> LinkedHashSet(parts.size());</span><br><span class="line">        MultiValueMap&lt;String, MultipartFile&gt; files = <span class="keyword">new</span> LinkedMultiValueMap(parts.size());</span><br><span class="line">        Iterator var4 = parts.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">            Part part = (Part)var4.next();</span><br><span class="line">            String disposition = part.getHeader(<span class="string">&quot;content-disposition&quot;</span>);</span><br><span class="line">            String filename = <span class="keyword">this</span>.extractFilename(disposition);</span><br><span class="line">            <span class="keyword">if</span> (filename == <span class="keyword">null</span>) &#123;</span><br><span class="line">                filename = <span class="keyword">this</span>.extractFilenameWithCharset(disposition);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">                files.add(part.getName(), <span class="keyword">new</span> StandardMultipartHttpServletRequest.StandardMultipartFile(part, filename));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.multipartParameterNames.add(part.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setMultipartFiles(files);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var8) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MultipartException(<span class="string">&quot;Could not parse multipart servlet request&quot;</span>, var8);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çœ‹äº†ä¸‹å’Œtomcatä¹‹å‰çš„åˆ†æå¾ˆåƒï¼Œè¿™é‡ŒSpring4å½“ä¸­åŒæ—¶ä¹Ÿæ˜¯æ”¯æŒ<code>filename*</code>æ ¼å¼çš„</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/14.png"></p><p>çœ‹çœ‹å…·ä½“é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">extractFilename</span><span class="params">(String contentDisposition, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (contentDisposition == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> startIndex = contentDisposition.indexOf(key);</span><br><span class="line">            <span class="keyword">if</span> (startIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              	<span class="comment">//æˆªå–filename=åé¢çš„å†…å®¹</span></span><br><span class="line">                String filename = contentDisposition.substring(startIndex + key.length());</span><br><span class="line">                <span class="keyword">int</span> endIndex;</span><br><span class="line">              	<span class="comment">//å¦‚æœåé¢å¼€å¤´æ˜¯â€œåˆ™æˆªå–â€â€œä¹‹é—´çš„å†…å®¹</span></span><br><span class="line">                <span class="keyword">if</span> (filename.startsWith(<span class="string">&quot;\&quot;&quot;</span>)) &#123;</span><br><span class="line">                    endIndex = filename.indexOf(<span class="string">&quot;\&quot;&quot;</span>, <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (endIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> filename.substring(<span class="number">1</span>, endIndex);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="comment">//å¯ä»¥çœ‹åˆ°å¦‚æœæ²¡æœ‰â€œâ€åŒ…è£¹å…¶å®ä¹Ÿå¯ä»¥ï¼Œè¿™å’Œå½“æ—¶é™ˆå¸ˆåˆ†äº«çš„å…¶ä¸­ä¸€ä¸ªtrickæ˜¯ç¬¦åˆçš„</span></span><br><span class="line">                    endIndex = filename.indexOf(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">                    <span class="keyword">if</span> (endIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> filename.substring(<span class="number">0</span>, endIndex);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> filename;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç®€å•æµ‹è¯•ä¸€æ³¢ï¼Œä¸å¿ƒä¸­ç»“æœä¸€è‡´</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/15.png"></p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/16.png">åŒæ—¶ç”±äºindexofé»˜è®¤å–ç¬¬ä¸€ä½ï¼Œå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥åŠ ä¸€äº›å¹²æ‰°å­—ç¬¦å°è¯•çªç ´wafé€»è¾‘</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/17.png"></p><p>å¦‚æœfilename*å¼€å¤´ä½†æ˜¯spring4å½“ä¸­æ²¡æœ‰å…³äºurlè§£ç çš„éƒ¨åˆ†</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/18.png"></p><p>æ²¡æœ‰è¿™éƒ¨åˆ†ä¼šå‡ºç°ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬åªèƒ½è‡ªå·±å‘åŒ…å‰è§£ç ï¼Œè¿™æ ·çš„è¯å¦‚æœå‡ºç°00å­—èŠ‚å°±ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™å</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/19.png"></p><p>çœ‹èµ·æ¥æ˜¯springæ¡†æ¶è§£æheaderçš„åŸå› ï¼Œä½†æ˜¯è¿™é‡ŒæŠ¥é”™ä¿¡æ¯ä¹Ÿå¾ˆæœ‰è¶£å°†é¡¹ç›®åœ°å€çš„ç»å¯¹è·¯å¾„æŠ›å‡ºäº†ï¼Œæ„Ÿè§‰ä¸å¤±ä¸ºä¿¡æ¯æ”¶é›†çš„ä¸€ç§æ–¹å¼</p><h3 id="Spring5"><a href="#Spring5" class="headerlink" title="Spring5"></a>Spring5</h3><p>ä¹Ÿæ˜¯éšä¾¿æ¥ä¸ªæ–°çš„springboot2.6.4çš„ï¼Œæ¥çœ‹çœ‹spring5çš„ï¼Œå°ç‰ˆæœ¬é—´å·®å¼‚ä¸æµ‹äº†ï¼Œç»è¿‡æµ‹è¯•å‘ç°spring5å’Œspring4ä¹‹é—´ä¹Ÿæ˜¯æœ‰ç‰ˆæœ¬å·®å¼‚å¤„ç†ä¹Ÿæœ‰äº›ä¸åŒï¼ŒåŒæ ·æ˜¯åœ¨<code>parseRequest</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Collection&lt;Part&gt; parts = request.getParts();</span><br><span class="line">            <span class="keyword">this</span>.multipartParameterNames = <span class="keyword">new</span> LinkedHashSet(parts.size());</span><br><span class="line">            MultiValueMap&lt;String, MultipartFile&gt; files = <span class="keyword">new</span> LinkedMultiValueMap(parts.size());</span><br><span class="line">            Iterator var4 = parts.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">                Part part = (Part)var4.next();</span><br><span class="line">                String headerValue = part.getHeader(<span class="string">&quot;Content-Disposition&quot;</span>);</span><br><span class="line">                ContentDisposition disposition = ContentDisposition.parse(headerValue);</span><br><span class="line">                String filename = disposition.getFilename();</span><br><span class="line">                <span class="keyword">if</span> (filename != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (filename.startsWith(<span class="string">&quot;=?&quot;</span>) &amp;&amp; filename.endsWith(<span class="string">&quot;?=&quot;</span>)) &#123;</span><br><span class="line">                        filename = StandardMultipartHttpServletRequest.MimeDelegate.decode(filename);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    files.add(part.getName(), <span class="keyword">new</span> StandardMultipartHttpServletRequest.StandardMultipartFile(part, filename));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.multipartParameterNames.add(part.getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.setMultipartFiles(files);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var9) &#123;</span><br><span class="line">            <span class="keyword">this</span>.handleParseFailure(var9);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°è¿™ä¸€è¡Œ<code>filename.startsWith(&quot;=?&quot;) &amp;&amp; filename.endsWith(&quot;?=&quot;)</code>ï¼Œå¯ä»¥çœ‹å‡ºSpringå¯¹æ–‡ä»¶åä¹Ÿæ˜¯æ”¯æŒQPç¼–ç </p><p>åœ¨ä¸Šé¢èƒ½çœ‹åˆ°è¿˜è°ƒç”¨äº†ä¸€ä¸ªè§£æçš„æ–¹æ³•<code>org.springframework.http.ContentDisposition#parse</code></p><p>ï¼Œå¤šåŠå°±æ˜¯è¿™é‡Œäº†,é‚£ä¹ˆç»§ç»­æ·±å…¥ä¸‹</p><p>å¯ä»¥çœ‹åˆ°ä¸€æ–¹é¢æ˜¯QPç¼–ç ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯æ”¯æŒ<code>filename*</code>,åŒæ ·è·å–å€¼æ˜¯æˆªå–<code>&quot;</code>ä¹‹é—´çš„æˆ–è€…æ²¡æ‰¾åˆ°å°±ç›´æ¥æˆªå–<code>=</code>åé¢çš„éƒ¨åˆ†</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/11.png"></p><p>å¦‚æœæ˜¯<code>filename*</code>åé¢çš„å¤„ç†é€»è¾‘å°±æ˜¯elseåˆ†ä¹‹ï¼Œå¯ä»¥çœ‹å‡ºå’Œæˆ‘ä»¬ä¸Šé¢åˆ†æspring4è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«å°±æ˜¯è¿™é‡Œåªæ”¯æŒ<code>UTF-8/ISO-8859-1/US_ASCII</code>ï¼Œç¼–ç å—é™åˆ¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> idx1 = value.indexOf(<span class="number">39</span>);</span><br><span class="line"><span class="keyword">int</span> idx2 = value.indexOf(<span class="number">39</span>, idx1 + <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (idx1 != -<span class="number">1</span> &amp;&amp; idx2 != -<span class="number">1</span>) &#123;</span><br><span class="line">  charset = Charset.forName(value.substring(<span class="number">0</span>, idx1).trim());</span><br><span class="line">  Assert.isTrue(StandardCharsets.UTF_8.equals(charset) || StandardCharsets.ISO_8859_1.equals(charset), <span class="string">&quot;Charset should be UTF-8 or ISO-8859-1&quot;</span>);</span><br><span class="line">  filename = decodeFilename(value.substring(idx2 + <span class="number">1</span>), charset);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  filename = decodeFilename(value, StandardCharsets.US_ASCII);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å…¶å®ä»”ç»†æƒ³è¿™ä¸ªç»“æœæ˜¯ç¬¦åˆRFCæ–‡æ¡£è¦æ±‚çš„</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/12.png"></p><p>æ¥ç€æˆ‘ä»¬ç»§ç»­åé¢ä¼šç»§ç»­æ‰§è¡Œ<code>decodeFilename</code></p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/13.png"></p><p>ä»£ç é€»è¾‘å¾ˆæ¸…æ™°å­—ç¬¦ä¸²çš„è§£ç ,å¦‚æœå­—ç¬¦ä¸²æ˜¯å¦åœ¨<code>RFC 5987</code>æ–‡æ¡£è§„å®šçš„Headerå­—ç¬¦å°±ç›´æ¥è°ƒç”¨baos.writeå†™å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">attr-char     = ALPHA / DIGIT</span><br><span class="line">                  / &quot;!&quot; / &quot;#&quot; / &quot;$&quot; / &quot;&amp;&quot; / &quot;+&quot; / &quot;-&quot; / &quot;.&quot;</span><br><span class="line">                  / &quot;^&quot; / &quot;_&quot; / &quot;`&quot; / &quot;|&quot; / &quot;~&quot;</span><br><span class="line">                  ; token except ( &quot;*&quot; / &quot;&#x27;&quot; / &quot;%&quot; )</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸åœ¨è¦æ±‚è¿™ä¸€ä½å¿…é¡»æ˜¯<code>%</code>ç„¶å16è¿›åˆ¶è§£ç åä¸¤ä½ï¼Œå…¶å®å°±æ˜¯urlè§£ç ï¼Œç®€å•æµ‹è¯•å³å¯</p><p><img src="/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/20.png"></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a target="_blank" rel="noopener" href="https://www.ch1ng.com/blog/264.html">https://www.ch1ng.com/blog/264.html</a></p><p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc6266#section-4.3">https://datatracker.ietf.org/doc/html/rfc6266#section-4.3</a></p><p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc2231">https://datatracker.ietf.org/doc/html/rfc2231</a></p><p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc5987#section-3.2.1">https://datatracker.ietf.org/doc/html/rfc5987#section-3.2.1</a></p><p><a href="https://y4tacker.github.io/2022/02/25/year/2022/2/Java%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%9D%80%E5%99%A8-%E7%BB%95waf(%E9%92%88%E5%AF%B9commons-fileupload%E7%BB%84%E4%BB%B6)/">https://y4tacker.github.io/2022/02/25/year/2022/2/Java%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%9D%80%E5%99%A8-%E7%BB%95waf(%E9%92%88%E5%AF%B9commons-fileupload%E7%BB%84%E4%BB%B6)/</a></p><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/Part.html#getSubmittedFileName--">https://docs.oracle.com/javaee/7/api/javax/servlet/http/Part.html#getSubmittedFileName--</a></p><p><a target="_blank" rel="noopener" href="http://t.zoukankan.com/summerday152-p-13969452.html#%E4%BA%8C%E3%80%81%E5%A4%84%E7%90%86%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6multipartfile%E6%8E%A5%E5%8F%A3">http://t.zoukankan.com/summerday152-p-13969452.html#%E4%BA%8C%E3%80%81%E5%A4%84%E7%90%86%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6multipartfile%E6%8E%A5%E5%8F%A3</a></p></div></article><div class="blog-post-comments"><div id="utterances_thread"><noscript>Please enable JavaScript to view the comments.</noscript></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF"><span class="toc-number">1.</span> <span class="toc-text">æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="toc-number">1.1.</span> <span class="toc-text">å†™åœ¨å‰é¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pre"><span class="toc-number">1.2.</span> <span class="toc-text">Pre</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">å‰ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5"><span class="toc-number">1.4.</span> <span class="toc-text">æ·±å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E5%BD%A2-%E6%9B%B4%E6%96%B02022-06-20"><span class="toc-number">1.5.</span> <span class="toc-text">å˜å½¢ æ›´æ–°2022-06-20</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%A4%A7%E5%88%A9%E7%94%A8%E9%9D%A2"><span class="toc-number">1.6.</span> <span class="toc-text">æ‰©å¤§åˆ©ç”¨é¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0Spring-2022-06-20"><span class="toc-number">1.7.</span> <span class="toc-text">æ›´æ–°Spring 2022-06-20</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring4"><span class="toc-number">1.7.1.</span> <span class="toc-text">Spring4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring5"><span class="toc-number">1.7.2.</span> <span class="toc-text">Spring5</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">1.8.</span> <span class="toc-text">å‚è€ƒæ–‡ç« </span></a></li></ol></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&text=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&is_video=false&description=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿&body=Check out this article: https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&title=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&name=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/&t=æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2016-2025 Y4tacker</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul><ul><span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡ </span><span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="display:none">æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></ul></nav></div></footer></div><link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload='this.onload=null,this.rel="stylesheet"'><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script><script type="text/javascript">$(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })</script><script src="/js/main.js"></script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e6d8a6d6d91254d9108e469862e88709";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">var utterances_repo="Y4tacker/y4tacker.github.io",utterances_issue_term="pathname",utterances_label="Comment",utterances_theme="github-dark";!function(){var t=document.createElement("script");t.src="https://utteranc.es/client.js",t.setAttribute("repo",utterances_repo),t.setAttribute("issue-term","pathname"),t.setAttribute("label",utterances_label),t.setAttribute("theme",utterances_theme),t.setAttribute("crossorigin","anonymous"),t.async=!0,document.getElementById("utterances_thread").appendChild(t)}()</script></body></html>